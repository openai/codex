# 🚀 メタプロンプト作成完了 - 継続的改良ガイドライン

**実装日時**: 2025-10-11 17:50 JST  
**バージョン**: 0.47.0-alpha.1  
**Status**: ✅ **完了**

---

## 📋 作成内容

### メタプロンプトファイル

**ファイル**: `.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`

**目的**: 将来のAIセッションで、zapabob/codexプロジェクトのサブエージェント機能とDeep Research機能を継続的にブラッシュアップするための包括的なガイドライン

---

## 📝 含まれる内容

### 1. プロジェクト現状把握
```
✅ Deep Research (v0.47.0-alpha.1)
   - DuckDuckGo統合
   - URLデコーダー
   - 202エラー対策
   - scraperクレート統合開始

✅ サブエージェント (v0.47.0-alpha.1)
   - 7種類のエージェント定義
   - delegateコマンド
   - シミュレーション実装
```

### 2. 改良優先度マトリクス

#### 🔴 高優先度（次回着手）
1. **scraperクレート完全統合**
   - regex依存削除
   - 堅牢なHTMLパース
   - テストケース追加

2. **サブエージェント実行エンジン実装**
   - AgentRuntime構造体
   - トークンバジェット管理
   - 権限チェック機構
   - MCPツール連携

3. **DuckDuckGo 202エラー根本解決**
   - Brave Search API統合
   - DuckDuckGo Instant Answer API調査
   - 実検索結果取得

#### 🟡 中優先度
4. Deep Research 計画型探索の改善
5. サブエージェント権限管理の強化
6. 統合テストスイートの拡充

#### 🟢 低優先度
7. GitHub Actions CI/CD強化
8. Web UI for Deep Research
9. VS Code拡張機能の改善
10. パフォーマンスベンチマーク

### 3. 開発フロー

#### A. セッション開始時
```bash
1. メタプロンプトを読む
2. 最新実装ログ確認
3. ブランチ確認
4. 最新コミット確認
```

#### B. 機能開発時
```bash
1. ブランチ戦略（main直接 or feature ブランチ）
2. コミット前チェックリスト
   - just fmt
   - just fix -p <project>
   - cargo test -p <project>
   - cargo build --release
3. Conventional Commits準拠
4. セマンティックバージョニング
```

#### C. コミット例
```bash
feat(deep-research): integrate scraper for HTML parsing

- Replace regex with scraper crate
- Improve robustness of DuckDuckGo parsing
- Add comprehensive test cases
- Update documentation

Closes #123
```

#### D. 実装ログ作成（必須）
```
_docs/yyyy-mm-dd_機能名.md
```

### 4. 品質基準（絶対遵守）

```bash
✅ cargo fmt --all で整形
✅ just fix -p <project> でClippy警告ゼロ
✅ cargo test -p <project> で全テスト合格
✅ unsafe コード使用禁止
✅ unwrap() 使用禁止（テスト以外）
✅ expect() 推奨
✅ ? 演算子でエラー伝播
✅ anyhow::Result または thiserror でエラー型定義
```

### 5. OpenAI/codex との同期方針

```
zapabob/codex = OpenAI/codex + サブエージェント + Deep Research

- upstream 変更は定期的に取り込む（週1回推奨）
- 独自機能は別ファイル・モジュールで実装
- コンフリクト最小化
```

### 6. テスト戦略

```
1. 単体テスト（必須）
2. 統合テスト（推奨）
3. E2Eテスト（重要機能のみ）
カバレッジ目標: 70%以上（コア機能は90%）
```

### 7. 既知の課題

#### Deep Research
- DuckDuckGo 202エラー（優先度: 🔴 高）
- scraperクレート完全移行（優先度: 🔴 高）
- 引用検証機能（優先度: 🟡 中）

#### サブエージェント
- 実行エンジン未実装（優先度: 🔴 高）
- 権限管理未実装（優先度: 🔴 高）
- MCPツール連携（優先度: 🟡 中）

### 8. マイルストーン

```
M1: scraperクレート完全統合（2週間以内）
M2: AgentRuntime MVP（1ヶ月以内）
M3: Deep Research v2（2ヶ月以内）
M4: Beta リリース（3ヶ月以内）
```

---

## 🎯 使い方

### 次回AIセッション開始時

```markdown
@codex このプロジェクトの改良を続けます。
`.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`を読んで、
現在の実装状況を把握してから作業を開始してください。
```

### 具体的なタスク実行時

```markdown
@codex `.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`の
「高優先度タスク1: scraperクレート完全統合」を実施してください。

完了条件:
- regex依存削除
- テストケース3件以上追加
- cargo test -p codex-deep-research 成功
```

---

## 📊 メタプロンプトの構成

| セクション | 行数 | 内容 |
|-----------|------|------|
| **プロジェクト現状** | ~50行 | 完成済み機能一覧 |
| **改良優先度** | ~200行 | 高/中/低優先度タスク |
| **開発フロー** | ~150行 | セッション開始〜コミットまで |
| **品質基準** | ~50行 | Rust/ドキュメント/テスト品質 |
| **OpenAI同期** | ~50行 | upstream取り込み方針 |
| **テスト戦略** | ~80行 | 単体/統合/E2Eテスト |
| **パフォーマンス** | ~30行 | 目標値と現状 |
| **既知の課題** | ~50行 | Deep Research/サブエージェント |
| **アイデアメモ** | ~40行 | 将来の拡張 |
| **参考リソース** | ~30行 | ドキュメント/Issue |
| **トラブルシューティング** | ~50行 | よくあるエラーと解決法 |
| **リリース管理** | ~40行 | Alpha/Beta/GA |
| **マイルストーン** | ~30行 | M1〜M4 |
| **チェックリスト** | ~20行 | セッション終了時 |
| **開発哲学** | ~30行 | 目標とnなんJ精神 |

**合計**: 約900行

---

## ✅ 効果

### 1. 継続性の確保
- 異なるAIセッション間で一貫した開発方針
- 実装の重複や矛盾を防止
- プロジェクトの進捗を可視化

### 2. 品質の保証
- 明確な品質基準
- テスト戦略の統一
- コードレビュー基準の共有

### 3. 効率の向上
- 優先度に基づいたタスク実行
- 開発フローの標準化
- トラブルシューティングの迅速化

### 4. コミュニティ貢献
- 新規コントリビューター向けガイド
- OpenAI/codexとの協調
- ドキュメントの充実

---

## 📚 関連ドキュメント

### 作成済み
1. **`.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`** ← このメタプロンプト
2. **`_docs/2025-10-11_全機能完全実装完了報告.md`** - 現状総括
3. **`_docs/2025-10-11_202エラー対策と最終実装.md`** - 202エラー詳細
4. **`FINAL_COMPLETION_SUMMARY.md`** - 最終サマリー
5. **`docs/codex-subagents-deep-research.md`** - 詳細設計
6. **`.codex/README.md`** - エージェント設定
7. **`AGENTS.md`** - サブエージェント一覧

### 今後作成予定
- `_docs/2025-10-XX_scraperクレート完全統合.md`
- `_docs/2025-10-XX_AgentRuntime実装完了.md`
- `_docs/2025-10-XX_Brave_Search_API統合.md`

---

## 🎯 次のステップ

### 即座に実行可能なタスク

#### 1. scraperクレート完全統合（最優先）
```bash
# 実装箇所: codex-rs/deep-research/src/web_search_provider.rs
# ユーザーが既に部分的に実装済み
# 次: regex依存完全削除 + テスト追加
```

#### 2. AgentRuntime MVP実装
```bash
# 新規ファイル: codex-rs/core/src/agent_runtime.rs
# 基本的な実行エンジン
# トークンバジェット管理
```

#### 3. Brave Search API統合
```bash
# 実装箇所: codex-rs/deep-research/src/web_search_provider.rs
# 環境変数: BRAVE_API_KEY
# フォールバックチェーン: Brave > DuckDuckGo
```

---

## 🎉 完了宣言

```
✅ メタプロンプト作成完了（900行）
✅ 継続的改良ガイドライン完備
✅ 優先度マトリクス定義
✅ 開発フロー標準化
✅ 品質基準明確化
✅ テスト戦略策定
✅ マイルストーン設定
```

---

## 💡 使用例

### 例1: 次回セッションで高優先度タスク実行

```markdown
**User**: scraperクレートを完全に統合して

**AI**: `.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`を確認しました。
高優先度タスク1として定義されています。

実施内容:
1. regex依存削除
2. scraper::Html/Selectorで実装
3. テストケース3件追加
4. cargo test実行

開始します...
```

### 例2: 特定機能のブラッシュアップ

```markdown
**User**: Deep Researchの精度を向上させて

**AI**: メタプロンプトの中優先度タスク4
「Deep Research 計画型探索の改善」に該当します。

実施内容:
1. スマートサブクエリ生成
2. 引用検証機能
3. 信頼性スコアリング

ベンチマーク目標: 精度 75% → 85%

開始します...
```

### 例3: コミット前の品質確認

```markdown
**User**: これコミットしていい？

**AI**: メタプロンプトの品質基準に照らして確認します:

✅ cargo fmt --all 実行済み
✅ just fix -p codex-deep-research 警告ゼロ
✅ cargo test -p codex-deep-research 全テスト合格
✅ unwrap()使用なし
✅ ドキュメント更新済み

→ コミット可能です！

推奨コミットメッセージ:
feat(deep-research): integrate scraper for HTML parsing

- Replace regex with scraper crate
- Add comprehensive test cases
- Improve robustness

Closes #123
```

---

## 📊 統計

| 項目 | 値 |
|------|-----|
| **メタプロンプト行数** | 約900行 |
| **セクション数** | 15セクション |
| **タスク数** | 10タスク（高3/中3/低4） |
| **マイルストーン** | 4個（M1〜M4） |
| **チェックリスト項目** | 30項目以上 |
| **作成時間** | 約30分 |

---

## 🎊 完了メッセージ

**完ッッッッッ璧や！！！** 🎉🎉🎉

```
✅ 継続的改良のためのメタプロンプト完成
✅ 900行の包括的ガイドライン
✅ 優先度付きタスクリスト
✅ 開発フロー標準化
✅ 品質基準明確化
✅ 次回AIセッションで即座に使用可能
```

**これで、どのAIセッションでも一貫した品質でプロジェクトを改良できるで！** 💪

---

**作成日時**: 2025-10-11 17:50 JST  
**ファイル**: `.codex/META_PROMPT_CONTINUOUS_IMPROVEMENT.md`  
**実装ログ**: `_docs/2025-10-11_メタプロンプト作成完了.md`  
**Status**: ✅ **完了**

---

**END OF IMPLEMENTATION LOG**

