# ğŸ”’ ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹APIã‚­ãƒ¼ç®¡ç†å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-11-02 (æ—¥)  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Codex v0.56.0-zapabob  
**æ‹…å½“è€…**: Cursor Agent  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Ÿè£…ç¢ºèªå®Œäº†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™å®Œäº†

---

## ğŸ“‹ å®Ÿè£…ã‚µãƒãƒªãƒ¼

### ğŸ¯ ç›®çš„
config.tomlã¸ã®APIã‚­ãƒ¼ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã€ç’°å¢ƒå¤‰æ•°ã§å®‰å…¨ã«ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã‚’ç¢ºç«‹ã™ã‚‹ã€‚

### âœ… çµæœ
**æ—¢ã«å®Œå…¨å®Ÿè£…æ¸ˆã¿**ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å®Œå…¨æº–æ‹ ã€‚

---

## ğŸ” å®Ÿè£…çŠ¶æ³ã®è©³ç´°èª¿æŸ»

### 1. ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿æ©Ÿæ§‹ï¼ˆauth.rsï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/core/src/auth.rs` 209-224è¡Œ

```rust
pub const OPENAI_API_KEY_ENV_VAR: &str = "OPENAI_API_KEY";
pub const CODEX_API_KEY_ENV_VAR: &str = "CODEX_API_KEY";

pub fn read_openai_api_key_from_env() -> Option<String> {
    env::var(OPENAI_API_KEY_ENV_VAR)
        .ok()
        .map(|value| value.trim().to_string())
        .filter(|value| !value.is_empty())
}

pub fn read_codex_api_key_from_env() -> Option<String> {
    env::var(CODEX_API_KEY_ENV_VAR)
        .ok()
        .map(|value| value.trim().to_string())
        .filter(|value| !value.is_empty())
}
```

**ç‰¹å¾´**:
- âœ… ç’°å¢ƒå¤‰æ•°ã®å€¤ã‚’ãƒˆãƒªãƒ ï¼ˆå‰å¾Œã®ç©ºç™½ã‚’é™¤å»ï¼‰
- âœ… ç©ºæ–‡å­—åˆ—ã‚’é™¤å¤–ï¼ˆæœªè¨­å®šæ‰±ã„ï¼‰
- âœ… 2ç¨®é¡ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆ`CODEX_API_KEY`, `OPENAI_API_KEY`ï¼‰

---

### 2. èªè¨¼å„ªå…ˆé †ä½åˆ¶å¾¡ï¼ˆauth.rsï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/core/src/auth.rs` 356-399è¡Œ

```rust
fn load_auth(
    codex_home: &Path,
    enable_codex_api_key_env: bool,
    auth_credentials_store_mode: AuthCredentialsStoreMode,
) -> std::io::Result<Option<CodexAuth>> {
    // ğŸ¥‡ Priority 1: CODEX_API_KEY environment variable
    if enable_codex_api_key_env && let Some(api_key) = read_codex_api_key_from_env() {
        let client = crate::default_client::create_client();
        return Ok(Some(CodexAuth::from_api_key_with_client(
            api_key.as_str(),
            client,
        )));
    }

    // ğŸ¥ˆ Priority 2: auth.json file
    let storage = create_auth_storage(codex_home.to_path_buf(), auth_credentials_store_mode);
    let auth_dot_json = match storage.load()? {
        Some(auth) => auth,
        None => return Ok(None),
    };

    let AuthDotJson {
        openai_api_key: auth_json_api_key,
        tokens,
        last_refresh,
    } = auth_dot_json;

    // Prefer AuthMode.ApiKey if it's set in the auth.json.
    if let Some(api_key) = &auth_json_api_key {
        return Ok(Some(CodexAuth::from_api_key_with_client(api_key, client)));
    }

    // ğŸ¥‰ Priority 3: OAuth tokens (ChatGPT)
    Ok(Some(CodexAuth {
        api_key: None,
        mode: AuthMode::ChatGPT,
        storage: storage.clone(),
        auth_dot_json: Arc::new(Mutex::new(Some(AuthDotJson {
            openai_api_key: None,
            tokens,
            last_refresh,
        }))),
        client,
    }))
}
```

**å„ªå…ˆé †ä½**:
1. ğŸ¥‡ **ç’°å¢ƒå¤‰æ•° `CODEX_API_KEY`** - æœ€å„ªå…ˆ
2. ğŸ¥ˆ **auth.jsonå†…ã®APIã‚­ãƒ¼** - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
3. ğŸ¥‰ **OAuth ãƒˆãƒ¼ã‚¯ãƒ³** - ChatGPTé€£æº

**ç‰¹å¾´**:
- âœ… ç’°å¢ƒå¤‰æ•°ãŒæœ€å„ªå…ˆã•ã‚Œã‚‹è¨­è¨ˆ
- âœ… `enable_codex_api_key_env`ãƒ•ãƒ©ã‚°ã§åˆ¶å¾¡å¯èƒ½
- âœ… auth.jsonã¨ã®ä½µç”¨ã‚‚å¯èƒ½ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

---

### 3. config.tomlè¨­å®šï¼ˆç¾çŠ¶ç¢ºèªï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `config.toml` 15-22è¡Œ

```toml
[model_providers.openai]
base_url = "https://api.openai.com/v1"
env_key = "OPENAI_API_KEY"  # â† ç’°å¢ƒå¤‰æ•°åã‚’æŒ‡å®š
name = "OpenAI (Chat Completions API)"
requires_openai_auth = true
wire_api = "chat"
enable_web_search = true
web_search_grounding = true
```

**ç¢ºèªçµæœ**:
- âœ… `env_key = "OPENAI_API_KEY"` ãŒè¨­å®šæ¸ˆã¿
- âœ… ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã¯ **å­˜åœ¨ã—ãªã„**
- âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªè¨­å®šãŒæ—¢ã«å®Œäº†

---

### 4. MCP Serverç’°å¢ƒå¤‰æ•°å—ã‘æ¸¡ã—

**ãƒ•ã‚¡ã‚¤ãƒ«**: `config.toml` 49-81è¡Œ

```toml
# Codex MCP Server
[mcp_servers.codex]
args = ["mcp-server"]
command = "codex"
env.GITHUB_TOKEN = "${GITHUB_TOKEN}"
env.OPENAI_API_KEY = "${OPENAI_API_KEY}"  # â† ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘æ¸¡ã—
env.RUST_LOG = "info"
env.SLACK_WEBHOOK_URL = "${SLACK_WEBHOOK_URL}"
startup_timeout_sec = 180

# Codex Research
[mcp_servers.codex-research]
args = ["research"]
command = "codex"
env.OPENAI_API_KEY = "${OPENAI_API_KEY}"  # â† ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘æ¸¡ã—
env.RUST_LOG = "info"
startup_timeout_sec = 180

# Codex Agent
[mcp_servers.codex-agent]
args = ["agent"]
command = "codex"
env.OPENAI_API_KEY = "${OPENAI_API_KEY}"  # â† ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘æ¸¡ã—
env.RUST_LOG = "info"
startup_timeout_sec = 180
```

**ç‰¹å¾´**:
- âœ… å„MCPã‚µãƒ¼ãƒãƒ¼ã«ç’°å¢ƒå¤‰æ•°ã‚’æ­£ã—ãå—ã‘æ¸¡ã—
- âœ… `${OPENAI_API_KEY}`æ§‹æ–‡ã§å‹•çš„ã«å€¤ã‚’æ³¨å…¥
- âœ… GitHub Tokenã€Slack Webhook URLã‚‚åŒæ§˜ã«ç®¡ç†

---

### 5. Gemini API Keyå¯¾å¿œï¼ˆauth/gemini.rsï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/core/src/auth/gemini.rs` 76-89è¡Œ

```rust
/// Get API key from environment or config
pub fn get_api_key(&self) -> Result<String> {
    // Check environment variables in priority order
    if let Ok(key) = std::env::var("GEMINI_API_KEY") {
        return Ok(key);
    }
    
    if let Ok(key) = std::env::var("GOOGLE_AI_STUDIO_API_KEY") {
        return Ok(key);
    }

    Err(anyhow!(
        "Gemini API key not found. Set GEMINI_API_KEY or GOOGLE_AI_STUDIO_API_KEY environment variable"
    ))
}
```

**ç‰¹å¾´**:
- âœ… 2ç¨®é¡ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆ`GEMINI_API_KEY`, `GOOGLE_AI_STUDIO_API_KEY`ï¼‰
- âœ… å„ªå…ˆé †ä½åˆ¶å¾¡ï¼ˆGEMINI_API_KEY > GOOGLE_AI_STUDIO_API_KEYï¼‰
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ˜ç¢º

---

## ğŸ“Š ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼çµæœ

### grepæ¤œç´¢ã«ã‚ˆã‚‹ç¢ºèª

```powershell
# ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸOpenAI APIã‚­ãƒ¼ã®æ¤œç´¢
grep -i "api_key\s*=\s*\"sk-" config.toml
# â†’ ãƒãƒƒãƒãªã— âœ…

# ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸé•·æ–‡å­—åˆ—ã®æ¤œç´¢
grep -i "key\s*=\s*\"[A-Za-z0-9_-]{20,}\"" config.toml
# â†’ ãƒãƒƒãƒãªã— âœ…
```

**çµè«–**: config.tomlã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã¯ **ä¸€åˆ‡å­˜åœ¨ã—ãªã„**

---

## ğŸ“¦ æˆæœç‰©

### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### `_docs/2025-11-02_ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼è¨­å®šã‚¬ã‚¤ãƒ‰.md`

**å†…å®¹**:
- ğŸ“‹ å®Ÿè£…çŠ¶æ³ã®è©³ç´°èª¬æ˜
- âš™ï¸ Windows/Linux/macOSç’°å¢ƒå¤‰æ•°è¨­å®šæ–¹æ³•
- ğŸ”„ å„ªå…ˆé †ä½ã®è©³ç´°
- âœ… è¨­å®šç¢ºèªæ–¹æ³•
- ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ğŸ“¦ MCP Serverç’°å¢ƒå¤‰æ•°è¨­å®š
- ğŸ¯ æ¨å¥¨è¨­å®šãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

**ãƒã‚¤ãƒ©ã‚¤ãƒˆ**:
- åˆå¿ƒè€…ã§ã‚‚åˆ†ã‹ã‚‹ä¸å¯§ãªèª¬æ˜
- PowerShell/bashä¸¡å¯¾å¿œ
- .envãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨ä¾‹
- ã‚»ã‚­ãƒ¥ã‚¢ãªè¨­å®šæ–¹æ³•ï¼ˆchmod 600ç­‰ï¼‰

### 2. PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### `zapabob/scripts/setup-env-vars.ps1`

**æ©Ÿèƒ½**:
- ğŸ¨ ã‚«ãƒ©ãƒ•ãƒ«ãªUIã§å¯¾è©±çš„ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
- ğŸ” APIã‚­ãƒ¼å½¢å¼ã®æ¤œè¨¼ï¼ˆOpenAI, GitHub, Gemini, Braveï¼‰
- ğŸ’¾ 3ã¤ã®è¨­å®šãƒ¢ãƒ¼ãƒ‰:
  - ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆä¸€æ™‚çš„ï¼‰
  - ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ï¼ˆæ°¸ç¶šåŒ–ï¼‰
  - PowerShell Profileï¼ˆè‡ªå‹•èª­ã¿è¾¼ã¿ï¼‰
- ğŸ“‹ ç¾åœ¨ã®ç’°å¢ƒå¤‰æ•°è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆ`-ShowCurrent`ï¼‰
- ğŸ”’ ã‚»ã‚­ãƒ¥ã‚¢ãªå…¥åŠ›å‡¦ç†ï¼ˆãƒã‚¹ã‚¯è¡¨ç¤ºï¼‰
- âœ… è¨­å®šå¾Œã®ç¢ºèªè¡¨ç¤º
- ğŸ“Œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

**ä½¿ç”¨ä¾‹**:
```powershell
# å¯¾è©±çš„ã«è¨­å®šï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰
.\zapabob\scripts\setup-env-vars.ps1

# ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æ°¸ç¶šåŒ–
.\zapabob\scripts\setup-env-vars.ps1 -Permanent

# PowerShell Profileã«è¿½åŠ 
.\zapabob\scripts\setup-env-vars.ps1 -Profile

# ç¾åœ¨ã®è¨­å®šã‚’è¡¨ç¤º
.\zapabob\scripts\setup-env-vars.ps1 -ShowCurrent
```

---

## ğŸ¯ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©åˆçŠ¶æ³

### âœ… é©åˆé …ç›®

| é …ç›® | çŠ¶æ…‹ | èª¬æ˜ |
|------|------|------|
| ç’°å¢ƒå¤‰æ•°ç®¡ç† | âœ… å®Œå…¨å®Ÿè£… | `CODEX_API_KEY`, `OPENAI_API_KEY`å¯¾å¿œ |
| ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å›é¿ | âœ… ç¢ºèªæ¸ˆã¿ | config.tomlã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç„¡ã— |
| å„ªå…ˆé †ä½åˆ¶å¾¡ | âœ… å®Ÿè£…æ¸ˆã¿ | ç’°å¢ƒå¤‰æ•° > auth.json > OAuth |
| .gitignoreè¨­å®š | âœ… è¨­å®šæ¸ˆã¿ | .env, auth.jsonã‚’é™¤å¤– |
| ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³åˆ¶é™ | âœ… ã‚¬ã‚¤ãƒ‰æ¸ˆã¿ | chmod 600ã®æ¨å¥¨ |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ | âœ… å®Œäº† | è©³ç´°ã‚¬ã‚¤ãƒ‰ä½œæˆ |
| ãƒ„ãƒ¼ãƒ«æä¾› | âœ… å®Œäº† | PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ |

### ğŸ”’ æ¨å¥¨ã•ã‚Œã‚‹è¨­å®š

```powershell
# Windows PowerShellï¼ˆæ¨å¥¨ï¼‰
$env:CODEX_API_KEY = "sk-proj-XXXXXXXXXXXXXXXXXXXX"

# Linux/macOSï¼ˆæ¨å¥¨ï¼‰
export CODEX_API_KEY="sk-proj-XXXXXXXXXXXXXXXXXXXX"
```

**ç†ç”±**:
1. `CODEX_API_KEY`ãŒæœ€å„ªå…ˆã•ã‚Œã‚‹
2. Codexå°‚ç”¨ã®APIã‚­ãƒ¼ã¨ã—ã¦ç®¡ç†ã§ãã‚‹
3. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®è¡çªã‚’å›é¿

---

## ğŸš€ åˆ©ç”¨é–‹å§‹æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒå¤‰æ•°è¨­å®š

**æ–¹æ³•A: ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰**
```powershell
cd C:\Users\downl\Desktop\codex
.\zapabob\scripts\setup-env-vars.ps1 -Permanent
```

**æ–¹æ³•B: æ‰‹å‹•è¨­å®š**
```powershell
# Windows PowerShell
$env:CODEX_API_KEY = "sk-proj-XXXXXXXXXXXXXXXXXXXX"

# æ°¸ç¶šåŒ–ï¼ˆã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ï¼‰
[System.Environment]::SetEnvironmentVariable("CODEX_API_KEY", "sk-proj-XXXX", [System.EnvironmentVariableTarget]::User)
```

### ã‚¹ãƒ†ãƒƒãƒ—2: è¨­å®šç¢ºèª

```powershell
# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
.\zapabob\scripts\setup-env-vars.ps1 -ShowCurrent

# ã¾ãŸã¯
echo $env:CODEX_API_KEY
```

### ã‚¹ãƒ†ãƒƒãƒ—3: Codexèµ·å‹•ãƒ†ã‚¹ãƒˆ

```powershell
# Codexã‚’èµ·å‹•ã—ã¦å‹•ä½œç¢ºèª
codex exec "echo test"
```

### ã‚¹ãƒ†ãƒƒãƒ—4: auth.jsonå‰Šé™¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ç’°å¢ƒå¤‰æ•°ã®ã¿ã§èªè¨¼ã™ã‚‹å ´åˆï¼š

```powershell
# auth.jsonã‚’å‰Šé™¤
Remove-Item -Path "$env:USERPROFILE\.codex\auth.json" -ErrorAction SilentlyContinue
```

---

## ğŸ“ˆ æŠ€è¡“çš„ãªè€ƒå¯Ÿ

### ãªãœç’°å¢ƒå¤‰æ•°ãŒå„ªã‚Œã¦ã„ã‚‹ã®ã‹ï¼Ÿ

#### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- âœ… **Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„**: config.tomlã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ã‚‚APIã‚­ãƒ¼ã¯æµå‡ºã—ãªã„
- âœ… **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ä¸Šã§ä¿è­·**: OS ãƒ¬ãƒ™ãƒ«ã®æ¨©é™ç®¡ç†ãŒå¯èƒ½
- âœ… **ä¸€æ™‚çš„ãªåˆ©ç”¨ãŒå®¹æ˜“**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã§è¨­å®šå¤‰æ›´å¯èƒ½

#### 2. æŸ”è»Ÿæ€§

- âœ… **ç’°å¢ƒã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ**: é–‹ç™º/æœ¬ç•ªã§ç•°ãªã‚‹APIã‚­ãƒ¼ã‚’ä½¿ç”¨
- âœ… **è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å…±æœ‰**: åŒã˜APIã‚­ãƒ¼ã‚’è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨
- âœ… **CI/CDçµ±åˆãŒå®¹æ˜“**: GitHub Actionsç­‰ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

#### 3. äº’æ›æ€§

- âœ… **12 Factor Appæº–æ‹ **: æ¥­ç•Œæ¨™æº–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- âœ… **å¤šãã®ãƒ„ãƒ¼ãƒ«ã¨ã®äº’æ›**: Docker, Kubernetesç­‰ã§ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹æ¨™æº–æ‰‹æ³•
- âœ… **OpenAIå…¬å¼æ¨å¥¨**: OpenAIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚æ¨å¥¨

---

## ğŸ” å‚è€ƒ: æ—¢å­˜ã®å®Ÿè£…ç®‡æ‰€

### Rustå®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œæ•° | æ©Ÿèƒ½ |
|---------|------|------|
| `codex-rs/core/src/auth.rs` | 209-224 | ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿é–¢æ•° |
| `codex-rs/core/src/auth.rs` | 356-399 | èªè¨¼å„ªå…ˆé †ä½åˆ¶å¾¡ |
| `codex-rs/core/src/auth/gemini.rs` | 76-89 | Gemini API Keyèª­ã¿è¾¼ã¿ |
| `codex-rs/core/src/config/mod.rs` | 279-298 | Configèª­ã¿è¾¼ã¿ |
| `codex-rs/core/src/config_loader/mod.rs` | 46-67 | è¨­å®šãƒ¬ã‚¤ãƒ¤ãƒ¼èª­ã¿è¾¼ã¿ |

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œæ•° | è¨­å®šå†…å®¹ |
|---------|------|---------|
| `config.toml` | 15-22 | OpenAI Providerè¨­å®š |
| `config.toml` | 49-81 | MCP Serverç’°å¢ƒå¤‰æ•° |
| `config-secure.toml` | 29-37 | ã‚»ã‚­ãƒ¥ã‚¢ãƒ¢ãƒ¼ãƒ‰è¨­å®š |

---

## ğŸ’¡ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

### 1. .envãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•èª­ã¿è¾¼ã¿

ç¾çŠ¶ã€ç’°å¢ƒå¤‰æ•°ã¯æ‰‹å‹•è¨­å®šãŒå¿…è¦ã€‚å°†æ¥çš„ã«ã¯`.codex/.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•èª­ã¿è¾¼ã¿ã‚’å®Ÿè£…ã™ã‚‹ã¨ä¾¿åˆ©ã€‚

```rust
// å®Ÿè£…ä¾‹ï¼ˆæœªå®Ÿè£…ï¼‰
pub fn load_env_file(codex_home: &Path) -> std::io::Result<()> {
    let env_file = codex_home.join(".env");
    if env_file.exists() {
        dotenv::from_path(&env_file)?;
    }
    Ok(())
}
```

### 2. APIã‚­ãƒ¼æš—å·åŒ–ä¿å­˜

ã‚ˆã‚Šé«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¿…è¦ãªå ´åˆã€APIã‚­ãƒ¼ã‚’æš—å·åŒ–ã—ã¦ä¿å­˜ã™ã‚‹æ©Ÿèƒ½ã€‚

```rust
// å®Ÿè£…ä¾‹ï¼ˆæœªå®Ÿè£…ï¼‰
pub fn encrypt_api_key(api_key: &str, master_password: &str) -> Result<Vec<u8>> {
    // AES-256-GCMç­‰ã§æš—å·åŒ–
}
```

### 3. APIã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

å®šæœŸçš„ãªAPIã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•åŒ–ã™ã‚‹æ©Ÿèƒ½ã€‚

```rust
// å®Ÿè£…ä¾‹ï¼ˆæœªå®Ÿè£…ï¼‰
pub async fn rotate_api_key(old_key: &str, new_key: &str) -> Result<()> {
    // å¤ã„ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã€æ–°ã—ã„ã‚­ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ
}
```

---

## ğŸ“ çµè«–

### âœ… å®Ÿè£…çŠ¶æ³ã¾ã¨ã‚

1. **ç’°å¢ƒå¤‰æ•°å¯¾å¿œ**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼ˆauth.rsï¼‰
2. **å„ªå…ˆé †ä½åˆ¶å¾¡**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆç’°å¢ƒå¤‰æ•° > auth.json > OAuthï¼‰
3. **config.tomlè¨­å®š**: âœ… ã‚»ã‚­ãƒ¥ã‚¢ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç„¡ã—ï¼‰
4. **MCP Serverå¯¾å¿œ**: âœ… ç’°å¢ƒå¤‰æ•°å—ã‘æ¸¡ã—å®Ÿè£…æ¸ˆã¿
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: âœ… è©³ç´°ã‚¬ã‚¤ãƒ‰ä½œæˆå®Œäº†
6. **ãƒ„ãƒ¼ãƒ«**: âœ… PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆå®Œäº†

### ğŸ¯ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»¥ä¸‹ã®æ‰‹é †ã§ç’°å¢ƒå¤‰æ•°ç®¡ç†ã«ç§»è¡Œã§ãã¾ã™ï¼š

1. **ç’°å¢ƒå¤‰æ•°è¨­å®š**: `.\zapabob\scripts\setup-env-vars.ps1 -Permanent`
2. **è¨­å®šç¢ºèª**: `.\zapabob\scripts\setup-env-vars.ps1 -ShowCurrent`
3. **Codexèµ·å‹•**: `codex exec "echo test"`
4. **ã‚¬ã‚¤ãƒ‰å‚ç…§**: `_docs/2025-11-02_ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼è¨­å®šã‚¬ã‚¤ãƒ‰.md`

### ğŸ† ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«

- **ç¾çŠ¶**: ğŸŸ¢ ã‚»ã‚­ãƒ¥ã‚¢ï¼ˆç’°å¢ƒå¤‰æ•°å¯¾å¿œå®Œå‚™ï¼‰
- **ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½ãƒªã‚¹ã‚¯ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç„¡ã—ï¼‰
- **æ¨å¥¨åº¦**: ğŸŸ¢ æœ¬ç•ªç’°å¢ƒåˆ©ç”¨å¯èƒ½

---

## ğŸ”— é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼è¨­å®šã‚¬ã‚¤ãƒ‰](_docs/2025-11-02_ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼è¨­å®šã‚¬ã‚¤ãƒ‰.md)
- [.cursorrules - Security Best Practices](../.cursorrules)
- [README.md - Configuration](../README.md)

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- [setup-env-vars.ps1](../zapabob/scripts/setup-env-vars.ps1)
- [play-completion-sound.ps1](../zapabob/scripts/play-completion-sound.ps1)

### å¤–éƒ¨ãƒªãƒ³ã‚¯

- [OpenAI API Keys](https://platform.openai.com/api-keys)
- [GitHub Personal Access Tokens](https://github.com/settings/tokens)
- [12 Factor App - Config](https://12factor.net/config)

---

**ä½œæˆè€…**: Cursor Agent  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: zapabob  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… Production Ready  
**æœ€çµ‚æ›´æ–°**: 2025-11-02 (æ—¥)

**ãªã‚“Jé¢¨ã‚³ãƒ¡ãƒ³ãƒˆ**: ãƒ¯ã‚¤ã€å®Œç’§ãªå®Ÿè£…ã‚’ç¢ºèªã—ã¦å¤§æº€è¶³ã‚„ï¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢ã‚‚å®Œç’§ã‚„ã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å……å®Ÿã—ã¨ã‚‹ã€‚ã“ã‚Œã§å®‰å¿ƒã—ã¦APIã‚­ãƒ¼ç®¡ç†ã§ãã‚‹ã§ãªï¼ğŸ”’âœ¨


