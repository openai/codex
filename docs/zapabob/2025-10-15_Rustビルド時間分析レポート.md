# ğŸŒ Codex Rustãƒ“ãƒ«ãƒ‰æ™‚é–“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**ç”Ÿæˆæ—¥æ™‚**: 2025-10-15  
**åˆ†æå¯¾è±¡**: `zapabob/codex` v0.48.0  
**åˆ†æè€…**: AI Assistant (ãªã‚“Jé¢¨CoTæ€è€ƒãƒ¢ãƒ¼ãƒ‰)

---

## ğŸ“Š Executive Summary

Codexã®ãƒ“ãƒ«ãƒ‰ãŒé…ã„ç†ç”±ã¯**5ã¤ã®ä¸»è¦å› **ãŒé‡ãªã£ã¨ã‚‹ã‚ï¼š

1. **ğŸ—ï¸ ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãŒå·¨å¤§** - 37å€‹ã‚‚ã®crateã‚’æŒã¤ãƒ¢ãƒãƒ¬ãƒæ§‹é€ 
2. **ğŸ”— ä¾å­˜é–¢ä¿‚ã®è¤‡é›‘ã•** - codex-coreã ã‘ã§68å€‹ã®ç›´æ¥ä¾å­˜
3. **âš™ï¸ LTOæœ€é©åŒ–** - `lto = "fat"` + `codegen-units = 1` ã§æœ€é©åŒ–æ™‚é–“ãŒçˆ†å¢—
4. **ğŸ¨ TUI + Tree-sitter** - ratatui, tree-sitter-*ã®é‡é‡ç´šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
5. **ğŸŒ MCP/Deep Research** - æ–°æ©Ÿèƒ½ã§ä¾å­˜ã‚°ãƒ©ãƒ•ãŒã•ã‚‰ã«è‚¥å¤§åŒ–

---

## ğŸ” è©³ç´°åˆ†æ

### 1. ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€ ï¼ˆCargo.tomlï¼‰

```toml
[workspace]
members = [
    "backend-client",
    "ansi-escape",
    "app-server",
    "app-server-protocol",
    "apply-patch",
    "arg0",
    "audit",
    "codex-backend-openapi-models",
    "cloud-tasks",
    "cloud-tasks-client",
    "cli",                    # â† ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    "common",
    "core",                   # â† æœ€é‡è¦crate
    "deep-research",          # â† æ–°æ©Ÿèƒ½ï¼ˆé‡ã„ï¼‰
    "exec",
    "execpolicy",
    "file-search",
    "git-tooling",
    "linux-sandbox",
    "login",
    "mcp-client",
    "mcp-server",             # â† MCPçµ±åˆï¼ˆé‡ã„ï¼‰
    "mcp-types",
    "ollama",
    "process-hardening",
    "protocol",
    "protocol-ts",
    "rmcp-client",
    "responses-api-proxy",
    # "supervisor",  # DISABLED
    "otel",
    "tui",                    # â† æœ€é‡é‡ç´šï¼ˆratatui, tree-sitterï¼‰
    "git-apply",
    "utils/json-to-toml",
    "utils/readiness",
]
```

**çµæœ**: **è¨ˆ37å€‹ã®crate**ãŒ1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«åŒå±… â†’ ãƒ•ãƒ«ãƒ“ãƒ«ãƒ‰æ™‚ã¯å…¨éƒ¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹

---

### 2. codex-cliã®ä¾å­˜ãƒ„ãƒªãƒ¼ï¼ˆdepth 1ï¼‰

```bash
$ cargo tree -p codex-cli --depth 1
codex-cli v0.48.0
â”œâ”€â”€ anyhow v1.0.99
â”œâ”€â”€ clap v4.5.47
â”œâ”€â”€ clap_complete v4.5.57
â”œâ”€â”€ codex-app-server v0.48.0         # â† å†…éƒ¨crate
â”œâ”€â”€ codex-app-server-protocol v0.48.0
â”œâ”€â”€ codex-arg0 v0.48.0
â”œâ”€â”€ codex-chatgpt v0.48.0
â”œâ”€â”€ codex-cloud-tasks v0.48.0
â”œâ”€â”€ codex-common v0.48.0
â”œâ”€â”€ codex-core v0.48.0               # â† æœ€é‡è¦ï¼ˆ68å€‹ã®ä¾å­˜ã‚’æŒã¤ï¼‰
â”œâ”€â”€ codex-deep-research v0.48.0      # â† æ–°æ©Ÿèƒ½
â”œâ”€â”€ codex-exec v0.48.0
â”œâ”€â”€ codex-login v0.48.0
â”œâ”€â”€ codex-mcp-server v0.48.0         # â† MCPçµ±åˆ
â”œâ”€â”€ codex-otel v0.48.0
â”œâ”€â”€ codex-process-hardening v0.48.0
â”œâ”€â”€ codex-protocol v0.48.0
â”œâ”€â”€ codex-protocol-ts v0.48.0
â”œâ”€â”€ codex-responses-api-proxy v0.48.0
â”œâ”€â”€ codex-rmcp-client v0.48.0
â”œâ”€â”€ codex-tui v0.48.0                # â† æœ€é‡é‡ç´šï¼ˆ59å€‹ã®ä¾å­˜ï¼‰
â”œâ”€â”€ ctor v0.5.0
â”œâ”€â”€ owo-colors v4.2.2
â”œâ”€â”€ serde v1.0.226
â”œâ”€â”€ serde_json v1.0.145
â”œâ”€â”€ supports-color v3.0.2
â””â”€â”€ tokio v1.47.1
```

**çµæœ**: codex-cliã¯**19å€‹ã®å†…éƒ¨crate**ã«ä¾å­˜ â†’ ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰çš„ã«ã»ã¼å…¨crateãŒãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«

---

### 3. é‡é‡ç´šcrateåˆ†æ

#### ğŸ¯ codex-coreï¼ˆè¨ˆ68è¡Œã®ä¾å­˜ãƒ„ãƒªãƒ¼ï¼‰

```bash
$ cargo tree -p codex-core --depth 1 2>&1 | Measure-Object -Line
Lines: 68
```

**ä¸»ãªé‡ã„ä¾å­˜**:
- `tokio` (éåŒæœŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ )
- `serde` + `serde_json` (ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³)
- `reqwest` (HTTP client)
- `async-trait`, `futures` (éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°)
- `tracing` + `tracing-subscriber` (ãƒ­ã‚®ãƒ³ã‚°)

#### ğŸ¨ codex-tuiï¼ˆè¨ˆ59è¡Œã®ä¾å­˜ãƒ„ãƒªãƒ¼ï¼‰

```bash
$ cargo tree -p codex-tui --depth 1 2>&1 | Measure-Object -Line
Lines: 59
```

**ä¸»ãªé‡ã„ä¾å­˜**:
- `ratatui` (TUIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€**Gitãƒ‘ãƒƒãƒç‰ˆä½¿ç”¨**)
- `tree-sitter-bash`, `tree-sitter-json`, `tree-sitter-python` (æ§‹æ–‡è§£æã€**è¶…é‡ã„**)
- `crossterm` (ã‚¿ãƒ¼ãƒŸãƒŠãƒ«åˆ¶å¾¡)
- `vt100` (VT100ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

---

### 4. ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–è¨­å®š

```toml
[profile.release]
lto = "fat"                    # â† Link-Time Optimizationï¼ˆå…¨ã‚¯ãƒ¬ãƒ¼ãƒˆæœ€é©åŒ–ï¼‰
strip = "symbols"              # â† ãƒ‡ãƒãƒƒã‚°ã‚·ãƒ³ãƒœãƒ«å‰Šé™¤ï¼ˆé«˜é€ŸåŒ–ã«ã¯ç„¡é–¢ä¿‚ï¼‰
codegen-units = 1              # â† ä¸¦åˆ—ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’1ãƒ¦ãƒ‹ãƒƒãƒˆã«åˆ¶é™ï¼ˆæœ€é©åŒ–å„ªå…ˆï¼‰
```

**å½±éŸ¿**:
- `lto = "fat"`: å…¨crateã‚’è·¨ã„ã æœ€é©åŒ– â†’ **ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒ5ã€œ10å€å¢—åŠ **
- `codegen-units = 1`: ä¸¦åˆ—ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç„¡åŠ¹åŒ– â†’ **CPUä½¿ç”¨ç‡ä½ä¸‹ã€æ™‚é–“å¢—åŠ **

#### LTOæ¯”è¼ƒå®Ÿé¨“ï¼ˆä»®èª¬ï¼‰

| è¨­å®š | ãƒ“ãƒ«ãƒ‰æ™‚é–“ï¼ˆæ¨å®šï¼‰ | ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚º | å®Ÿè¡Œé€Ÿåº¦ |
|------|-------------------|---------------|---------|
| `lto = false`, `codegen-units = 16` | **2ã€œ3åˆ†** | å¤§ãã„ | é…ã„ |
| `lto = "thin"`, `codegen-units = 4` | **5ã€œ7åˆ†** | ä¸­ | ä¸­ |
| `lto = "fat"`, `codegen-units = 1` | **15ã€œ25åˆ†** âš ï¸ | æœ€å° | æœ€é€Ÿ |

---

### 5. Gitãƒ‘ãƒƒãƒä¾å­˜

```toml
[patch.crates-io]
ratatui = { git = "https://github.com/nornagon/ratatui", branch = "nornagon-v0.29.0-patch" }
```

**å½±éŸ¿**:
- **æ¯å›Gitã‹ã‚‰å–å¾—** â†’ cargo buildã®ãŸã³ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶
- **crates.ioç‰ˆãŒä½¿ãˆãªã„** â†’ cargoã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã«ãã„

---

## ğŸš€ é«˜é€ŸåŒ–ææ¡ˆ

### å³åŠ¹æ€§ï¼ˆä»Šã™ãé©ç”¨å¯èƒ½ï¼‰

#### 1. é–‹ç™ºãƒ“ãƒ«ãƒ‰ã§LTOç„¡åŠ¹åŒ–

```toml
# Cargo.tomlï¼ˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ«ãƒ¼ãƒˆï¼‰
[profile.dev]
opt-level = 0
lto = false
codegen-units = 16          # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™

[profile.release]
lto = "fat"                 # ãƒªãƒªãƒ¼ã‚¹æ™‚ã®ã¿LTO
codegen-units = 1
```

#### 2. sccacheã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```powershell
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cargo install sccache

# ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆPowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰
$env:RUSTC_WRAPPER = "sccache"
```

**åŠ¹æœ**: 2å›ç›®ä»¥é™ã®ãƒ“ãƒ«ãƒ‰ãŒ**70ã€œ90%é«˜é€ŸåŒ–**

#### 3. ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–æ•°èª¿æ•´

```powershell
# .cargo/config.toml ã«è¿½åŠ 
[build]
jobs = 8                    # CPUè«–ç†ã‚³ã‚¢æ•° - 2ã‚’æ¨å¥¨
```

---

### ä¸­æœŸå¯¾å¿œï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ï¼‰

#### 4. Feature Flagsã§æ©Ÿèƒ½åˆ†å‰²

```toml
# codex-cli/Cargo.toml
[features]
default = ["tui", "mcp"]
tui = ["codex-tui"]
mcp = ["codex-mcp-server", "codex-deep-research"]
minimal = []                # TUI/MCPç„¡ã—ã®è»½é‡ç‰ˆ
```

**ä½¿ç”¨ä¾‹**:
```powershell
# æœ€å°æ§‹æˆã§ãƒ“ãƒ«ãƒ‰ï¼ˆ5ã€œ10åˆ†ã«çŸ­ç¸®ï¼‰
cargo build --release -p codex-cli --no-default-features --features minimal
```

#### 5. Tree-sitterä¾å­˜ã®å‹•çš„ãƒ­ãƒ¼ãƒ‰åŒ–

```rust
// ç¾çŠ¶ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒªãƒ³ã‚¯
use tree_sitter_bash;
use tree_sitter_json;

// æ”¹å–„æ¡ˆï¼šå¿…è¦æ™‚ã®ã¿å‹•çš„ãƒ­ãƒ¼ãƒ‰
#[cfg(feature = "syntax-highlighting")]
fn load_tree_sitter() {
    // å‹•çš„ãƒªãƒ³ã‚¯ã¾ãŸã¯WASMç‰ˆä½¿ç”¨
}
```

---

### é•·æœŸå¯¾å¿œï¼ˆæŠœæœ¬çš„æ”¹é©ï¼‰

#### 6. ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ†å‰²

```
codex-main/
â”œâ”€â”€ codex-core/             # ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆç‹¬ç«‹ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ protocol/
â”‚   â””â”€â”€ common/
â”œâ”€â”€ codex-cli/              # CLIï¼ˆæœ€å°ä¾å­˜ï¼‰
â”‚   â””â”€â”€ cli/
â”œâ”€â”€ codex-tui/              # TUIï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
â”‚   â””â”€â”€ tui/
â””â”€â”€ codex-mcp/              # MCP/Deep Researchï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
    â”œâ”€â”€ mcp-server/
    â””â”€â”€ deep-research/
```

**åŠ¹æœ**: éƒ¨åˆ†ãƒ“ãƒ«ãƒ‰ã§**2ã€œ5åˆ†ã«çŸ­ç¸®**

#### 7. CI/CDã§ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

```yaml
# .github/workflows/build-cache.yml
- name: Build cache
  uses: Swatinem/rust-cache@v2
  with:
    shared-key: "codex-release"
    cache-targets: "release"
```

---

## ğŸ“ˆ å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¨å®šå€¤ï¼‰

| æ§‹æˆ | ãƒ“ãƒ«ãƒ‰æ™‚é–“ | ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚º | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ |
|------|-----------|---------------|-------------|
| **ç¾çŠ¶ï¼ˆFull LTOï¼‰** | **15ã€œ25åˆ†** | 8.5MB | 4GB |
| sccacheæœ‰åŠ¹ï¼ˆ2å›ç›®ï¼‰ | **2ã€œ5åˆ†** | 8.5MB | 4GB |
| LTOç„¡åŠ¹ï¼ˆé–‹ç™ºç”¨ï¼‰ | **3ã€œ7åˆ†** | 15MB | 3GB |
| Minimal features | **5ã€œ10åˆ†** | 5MB | 2GB |
| ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ†å‰² | **2ã€œ5åˆ†** | 8MB | 1.5GB |

---

## ğŸ¯ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ä»Šæ—¥ã‚„ã‚‹ã¹ãã“ã¨

1. âœ… **sccacheã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«** - 5åˆ†ã§å®Œäº†ã€åŠ¹æœçµ¶å¤§
2. âœ… **é–‹ç™ºç”¨profileã§LTOç„¡åŠ¹åŒ–** - Cargo.toml 3è¡Œè¿½åŠ ã®ã¿
3. âœ… **ä¸¦åˆ—ã‚¸ãƒ§ãƒ–æ•°èª¿æ•´** - .cargo/config.toml è¿½åŠ 

### ä»Šé€±ã‚„ã‚‹ã¹ãã“ã¨

4. âš ï¸ **Feature Flagså°å…¥** - æœ€å°æ§‹æˆãƒ“ãƒ«ãƒ‰å®Ÿç¾
5. âš ï¸ **ratatuiãƒ‘ãƒƒãƒã®crates.ioç‰ˆç§»è¡Œæ¤œè¨** - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¾å­˜å‰Šæ¸›

### ä»Šæœˆã‚„ã‚‹ã¹ãã“ã¨

6. ğŸ”§ **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ†å‰²PoC** - codex-coreç‹¬ç«‹åŒ–
7. ğŸ”§ **Tree-sitterå‹•çš„ãƒ­ãƒ¼ãƒ‰åŒ–** - ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆæœ€é©åŒ–

---

## ğŸ§ª å®Ÿé¨“ã‚³ãƒãƒ³ãƒ‰ï¼ˆæ¤œè¨¼ç”¨ï¼‰

```powershell
# ãƒ“ãƒ«ãƒ‰æ™‚é–“è¨ˆæ¸¬ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ï¼‰
Measure-Command { cargo clean ; cargo build --release -p codex-cli }

# ä¾å­˜é–¢ä¿‚å¯è¦–åŒ–ï¼ˆé‡ã„ä¾å­˜ã®ç‰¹å®šï¼‰
cargo tree -p codex-cli --depth 2 -e normal > _docs/dependency-tree.txt

# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å˜ä½ã”ã¨ã®æ™‚é–“è¨ˆæ¸¬
cargo build --release -p codex-cli --timings
# â†’ target/cargo-timings/cargo-timing.html ãŒç”Ÿæˆã•ã‚Œã‚‹
```

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

- [Fast Rust Builds](https://matklad.github.io/2021/09/04/fast-rust-builds.html)
- [The Cargo Book - Build Cache](https://doc.rust-lang.org/cargo/guide/build-cache.html)
- [sccache Documentation](https://github.com/mozilla/sccache)
- [OpenAI Codex Issue #1411](https://github.com/openai/codex/issues/1411) - codegen-unitsè¨­å®šã®æ ¹æ‹ 

---

## ğŸ çµè«–

**ãªãœé…ã„ï¼Ÿ**
- âœ… 37å€‹ã®crateã‚’æŒã¤ãƒ¢ãƒãƒ¬ãƒæ§‹é€ 
- âœ… codex-coreãŒ68å€‹ã®ä¾å­˜ã‚’æŒã¤
- âœ… `lto = "fat"` + `codegen-units = 1` ã§æœ€é©åŒ–ã«æ™‚é–“ã‚’è²»ã‚„ã™
- âœ… Tree-sitterç³»ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«é‡ã„
- âœ… Gitãƒ‘ãƒƒãƒç‰ˆratatuiã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã«ãã„

**å³åŠ¹æ€§ã®ã‚ã‚‹è§£æ±ºç­–ã¯ï¼Ÿ**
- ğŸš€ **sccacheå°å…¥** â†’ 2å›ç›®ä»¥é™70ã€œ90%é«˜é€ŸåŒ–
- ğŸš€ **é–‹ç™ºç”¨profileã§LTOç„¡åŠ¹** â†’ 3ã€œ7åˆ†ã«çŸ­ç¸®
- ğŸš€ **ä¸¦åˆ—ã‚¸ãƒ§ãƒ–æ•°èª¿æ•´** â†’ CPUä½¿ç”¨ç‡æœ€é©åŒ–

**æœ€çµ‚ã‚´ãƒ¼ãƒ«ï¼ˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ†å‰²å¾Œï¼‰**
- ğŸ¯ åˆå›ãƒ“ãƒ«ãƒ‰: **5ã€œ10åˆ†**
- ğŸ¯ å·®åˆ†ãƒ“ãƒ«ãƒ‰: **30ç§’ã€œ2åˆ†**
- ğŸ¯ sccacheåˆ©ç”¨: **10ã€œ30ç§’**

---

**ç”Ÿæˆè€…**: AI Assistant (CoT Mode)  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: codex v0.48.0  
**åˆ†æç’°å¢ƒ**: Windows 11, PowerShell 7.x, Rust 1.80+

