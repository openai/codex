# Cursor IDE統合ガイド - codex v0.48.0-zapabob.1

**作成日**: 2025-10-21 19:45 JST  
**対象バージョン**: codex-cli v0.48.0-zapabob.1  
**環境**: Windows 10 + Cursor IDE

---

## 🎯 概要

このガイドでは、`codex-cli v0.48.0-zapabob.1` をCursor IDEと統合し、生産性を最大化する方法を説明します。

**統合による利点**:
- ✅ Cursor IDE内から直接codexを呼び出し
- ✅ コンテキストを保持した対話
- ✅ マルチファイル編集の自動化
- ✅ zapabob独自機能（delegate, research, webhook）の活用
- ✅ シームレスなAI支援開発

---

## 📋 前提条件

### 必須環境

- ✅ Windows 10/11
- ✅ Cursor IDE（最新版推奨）
- ✅ codex-cli v0.48.0-zapabob.1 グローバルインストール済み
- ✅ PowerShell 5.1以上

### 確認コマンド

```powershell
# codexバージョン確認
PS> codex --version
codex-cli 0.48.0-zapabob.1

# インストール場所確認
PS> (Get-Command codex).Source
C:\Users\downl\.cargo\bin\codex.exe
```

---

## 🔧 MCP統合設定

### Step 1: MCP設定ファイル確認

**ファイルパス**: `C:\Users\downl\.cursor\mcp.json`

**現在の設定**:
```json
{
  "mcpServers": {
    "codex": {
      "command": "codex",
      "args": ["mcp-server"],
      "description": "Codex AI coding assistant with sub-agents, auto-orchestration, and integrated tools (zapabob fork v0.48.0-zapabob.1)",
      "env": {
        "CODEX_CONFIG_PATH": "C:\\Users\\downl\\.codex\\config.toml",
        "RUST_LOG": "info"
      }
    }
  }
}
```

**設定内容**:
- `command`: グローバルインストール済みの`codex`コマンド
- `args`: MCP serverモード（stdio transport）
- `env.CODEX_CONFIG_PATH`: codex設定ファイルのパス
- `env.RUST_LOG`: ログレベル（`info`推奨）

---

### Step 2: Cursor IDE再起動

MCP設定を反映させるため、**Cursor IDEを完全再起動**してください。

```
1. Cursor IDEを閉じる（全ウィンドウ）
2. タスクマネージャーでCursorプロセスが残っていないか確認
3. Cursor IDEを再起動
```

---

### Step 3: MCP接続確認

Cursor IDE再起動後、以下を確認:

**確認方法**:
1. Cursor IDEの設定画面を開く
2. `Extensions` → `MCP Servers` を確認
3. `codex` サーバーが **Enabled** になっているか確認

**期待される表示**:
```
✅ codex - Enabled
   Description: Codex AI coding assistant with sub-agents...
   Status: Connected
```

---

## 🚀 基本的な使い方

### 1. Cursorチャットからcodexを呼び出し

Cursorのチャット欄で `@codex` でcodexを呼び出せます。

#### 例1: コードレビュー

```
@codex このファイルをレビューして、セキュリティ上の問題を指摘してください
```

codexが現在開いているファイルを分析し、以下を提供:
- セキュリティ脆弱性の検出
- ベストプラクティスの提案
- パフォーマンス最適化のヒント

---

#### 例2: リファクタリング

```
@codex この関数をTypeScriptの型安全性を向上させてリファクタリングして
```

codexが:
- 型定義の改善提案
- 型推論の活用
- エラーハンドリングの改善

---

#### 例3: テスト生成

```
@codex このクラスの単体テストをJestで生成して
```

codexが自動的に:
- テストケースの網羅的生成
- モックの設定
- エッジケースのカバー

---

### 2. zapabob独自機能の活用

#### サブエージェント委譲

```
@codex delegate code-reviewer --scope ./src
```

専門の`CodeExpert`エージェントがコードレビューを実施。

**利用可能なエージェント**:
- `code-reviewer`: コードレビュー専門
- `security-expert`: セキュリティ分析
- `test-gen`: テスト生成
- `docs-expert`: ドキュメント作成
- `performance-expert`: パフォーマンス最適化

---

#### Deep Research

```
@codex research "React Server Components best practices" --depth 3
```

codexが自動的に:
- 複数ソースから情報収集
- 引用付きレポート作成
- 矛盾検出と信頼性評価

**リサーチ戦略**:
- `comprehensive`: 深い調査（5+ sources）
- `focused`: 集中調査（特定トピック）
- `exploratory`: 広範囲調査（全体把握）

---

#### Webhook統合

```
@codex webhook slack --text "ビルド完了: v0.48.0-zapabob.1" --channel "#dev"
```

CI/CD統合やチーム通知に活用。

**対応サービス**:
- GitHub API
- Slack Webhook
- Custom HTTP Webhook

---

## 💡 実践的な使用例

### 例1: 新機能の実装

**タスク**: Reactコンポーネントの作成

```typescript
// Step 1: Cursorチャットで指示
@codex 
ユーザープロフィール表示用のReactコンポーネントを作成してください。
要件:
- TypeScript使用
- Material-UI v5
- レスポンシブデザイン
- アバター画像表示
- 編集ボタン
```

codexが自動的に:
1. コンポーネントファイル生成（`UserProfile.tsx`）
2. 型定義ファイル生成（`UserProfile.types.ts`）
3. スタイル定義（`UserProfile.styles.ts`）
4. ユニットテスト（`UserProfile.test.tsx`）

---

### 例2: バグ修正

**タスク**: エラーが発生しているコードの修正

```
// Step 1: エラー箇所を選択
// Step 2: Cursorチャットで指示
@codex 
このエラーを修正してください:
TypeError: Cannot read property 'name' of undefined
```

codexが:
1. エラー原因を特定
2. 適切なエラーハンドリングを追加
3. 型ガードの実装
4. テストケースの追加

---

### 例3: コードベース全体のレビュー

**タスク**: プロジェクト全体のセキュリティレビュー

```powershell
# ターミナルで実行（Cursor統合ターミナル）
codex delegate security-expert --scope ./
```

`SecurityExpert`エージェントが:
1. 全ファイルをスキャン
2. 脆弱性を検出
3. 修正提案を作成
4. レポートを生成

---

### 例4: ドキュメント自動生成

**タスク**: API仕様書の作成

```
@codex delegate docs-expert --scope ./src/api
```

`DocsExpert`エージェントが:
1. APIエンドポイントを分析
2. OpenAPI/Swagger仕様書を生成
3. JSDocコメントを追加
4. README.mdを更新

---

## 🎯 高度な使い方

### 1. 並列エージェント実行

複数の専門エージェントを同時に実行して、3倍高速化。

```powershell
codex delegate-parallel code-reviewer,test-gen --scopes ./src,./tests
```

**効果**:
- コードレビューとテスト生成を並列実行
- 所要時間: 約1/3に短縮
- 品質: 各エージェントの専門性を活用

---

### 2. カスタムエージェント作成

独自のワークフロー用エージェントを作成。

```powershell
codex agent-create "すべてのTODOコメントを検出してサマリー作成"
```

codexが:
1. プロジェクト全体をスキャン
2. TODOコメントを抽出
3. 優先度付けしてリスト化
4. Markdownレポート生成

---

### 3. 自動オーケストレーション

複雑なタスクを自動的に分解・並列実行。

```
@codex 
セキュアなユーザー認証システムを実装してください。
JWT、リフレッシュトークン、CSRF対策込みで。
```

`AutoOrchestrator`が:
1. タスクを分析（複雑度判定）
2. サブタスクに分解
3. 適切なエージェントを自動選択
4. 並列実行で高速化
5. 結果を統合

**実行例**:
```
TaskAnalyzer: 複雑度 High → 自動オーケストレーション起動
├─ SecurityExpert: JWT実装
├─ CodeExpert: トークン管理
├─ TestingExpert: セキュリティテスト
└─ AutoOrchestrator: 統合・競合解決
```

---

### 4. ThreeWayMerge（競合解決）

複数エージェントが同じファイルを編集した場合、自動競合解決。

**シナリオ**:
1. `CodeExpert`: 関数のリファクタリング
2. `SecurityExpert`: 同じ関数にセキュリティ強化
3. `ThreeWayMerge`: 両方の変更を統合

**マージ戦略**:
- `ours`: 最初のエージェントの変更を優先
- `theirs`: 後のエージェントの変更を優先
- `auto`: 自動マージ（インテリジェント統合）

---

## ⚙️ 設定カスタマイズ

### codex設定ファイル

**パス**: `C:\Users\downl\.codex\config.toml`

**推奨設定**（Cursor統合用）:

```toml
# モデル設定
model = "gpt-5-codex"  # または "o3" for 高度なタスク

# サンドボックス設定（セキュリティ）
[sandbox]
default_mode = "workspace-write"  # Cursor統合では書き込み許可

[approval]
policy = "on-request"  # コマンド実行前に確認

# zapabob独自機能
[zapabob]
enable_auto_orchestration = true   # 自動オーケストレーション
enable_deep_research = true        # Deep Research
enable_webhook = true              # Webhook統合

# エージェント設定
[agents]
default_budget = 100000  # トークン予算
parallel_execution = true
```

---

### Cursor IDE設定

**推奨Cursor設定**:

```json
{
  "cursor.aiEnabled": true,
  "cursor.mcp.autoConnect": true,
  "cursor.mcp.preferredServer": "codex",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll": true
  }
}
```

---

## 🔒 セキュリティベストプラクティス

### 1. サンドボックスモード

codexのコマンド実行は常にサンドボックス内で。

```toml
[sandbox]
default_mode = "workspace-write"  # ワークスペース内のみ書き込み許可
```

**禁止事項**:
- ❌ `danger-full-access` モード（本番環境では使用禁止）
- ❌ `--approval never` フラグ（自動承認禁止）

---

### 2. API Key管理

環境変数で管理、ハードコーディング禁止。

```powershell
# 環境変数設定
$env:OPENAI_API_KEY = "sk-..."
$env:GITHUB_TOKEN = "ghp_..."
$env:SLACK_WEBHOOK_URL = "https://hooks.slack.com/..."
```

**絶対にやってはいけないこと**:
- ❌ config.tomlに直接API Keyを記載
- ❌ コード内にAPI Keyをハードコーディング
- ❌ Gitリポジトリにシークレットをコミット

---

### 3. コードレビュー

AI生成コードは必ずレビュー。

**チェックポイント**:
- ✅ セキュリティ脆弱性（SQL injection, XSS等）
- ✅ 認証・認可ロジック
- ✅ 暗号化処理
- ✅ ファイル操作
- ✅ ネットワークリクエスト

---

## 📊 パフォーマンス最適化

### 1. モデル選択

| タスク | 推奨モデル | 理由 |
|--------|-----------|------|
| クイック修正 | `gpt-4o-mini` | 高速・低コスト |
| 標準開発 | `gpt-4o` | バランス |
| 複雑なリファクタリング | `gpt-4o` | 強力なコード理解 |
| アルゴリズム設計 | `o3` | 最高の推論能力 |

---

### 2. 並列実行の活用

```powershell
# 逐次実行（遅い）
codex delegate code-reviewer --scope ./src
codex delegate test-gen --scope ./tests

# 並列実行（3倍高速）
codex delegate-parallel code-reviewer,test-gen --scopes ./src,./tests
```

---

### 3. キャッシュ活用

codexは自動的にLSPインデックスとファイルシステムキャッシュを使用。

**最適化**:
- 同じディレクトリでの連続タスクは高速化される
- `.codex/cache/` ディレクトリを定期的にクリーンアップ（週1回推奨）

---

## 🐛 トラブルシューティング

### 問題1: Cursor IDEでcodexが表示されない

**症状**: `@codex` で呼び出せない

**解決策**:
1. Cursor IDEを完全再起動
2. MCP設定ファイルを確認（`mcp.json`）
3. codexがグローバルインストールされているか確認

```powershell
PS> codex --version
codex-cli 0.48.0-zapabob.1
```

---

### 問題2: "Error: stdout is not a terminal"

**症状**: コマンド実行時にエラー

**原因**: PowerShellのパイプ処理時のTTY検出

**解決策**: 通常使用では発生しない。無視して問題なし。

---

### 問題3: MCP Server接続エラー

**症状**: `codex` MCPサーバーが `Disconnected` 状態

**解決策**:
1. 手動でMCP Serverを起動テスト

```powershell
PS> codex mcp-server
# Ctrl+C で停止
```

2. ログファイル確認

```powershell
PS> $env:RUST_LOG="debug"
PS> codex mcp-server
```

3. config.toml確認

```powershell
PS> cat ~\.codex\config.toml
```

---

### 問題4: パフォーマンスが遅い

**症状**: codex応答が遅い

**解決策**:
1. より高速なモデルを使用

```toml
model = "gpt-4o-mini"  # 高速版
```

2. 並列実行を活用

```powershell
codex delegate-parallel ...
```

3. キャッシュクリア

```powershell
Remove-Item -Recurse -Force ~\.codex\cache\*
```

---

## 📚 リファレンス

### Cursorチャットコマンド一覧

| コマンド | 説明 | 例 |
|---------|------|-----|
| `@codex [prompt]` | 基本的なcodex呼び出し | `@codex このコードを最適化して` |
| `@codex delegate [agent]` | エージェント委譲 | `@codex delegate code-reviewer` |
| `@codex research [topic]` | Deep Research | `@codex research "React hooks"` |
| `@codex webhook [service]` | Webhook送信 | `@codex webhook slack --text "完了"` |

---

### zapabob独自エージェント

| エージェント | 専門分野 | トークン予算 |
|------------|---------|-------------|
| `code-reviewer` | コードレビュー、ベストプラクティス | 40,000 |
| `test-gen` | テスト生成（Unit/Integration/E2E） | 30,000 |
| `security-expert` | セキュリティ分析、脆弱性検出 | 50,000 |
| `docs-expert` | ドキュメント生成、API仕様書 | 40,000 |
| `performance-expert` | パフォーマンス最適化 | 40,000 |
| `debug-expert` | バグ修正、デバッグ支援 | 35,000 |
| `deep-researcher` | Deep Research実行 | 60,000 |
| `general` | 汎用タスク | 50,000 |

---

### コマンドライン統合

Cursor統合ターミナルから直接codexを実行可能。

```powershell
# 基本的なコマンド
codex --version
codex --help

# エージェント委譲
codex delegate code-reviewer --scope ./src

# 並列実行
codex delegate-parallel code-reviewer,test-gen --scopes ./src,./tests

# Deep Research
codex research "React Server Components" --depth 3

# Webhook
codex webhook github --endpoint /repos/user/repo/issues --data '{"title":"Bug"}'
```

---

## 🎯 生産性向上のTips

### Tip 1: コンテキストの活用

codexは現在開いているファイルとカーソル位置を自動的に認識。

**例**:
```typescript
// カーソル位置に関数があるとき
@codex この関数のテストを生成して
```

codexが自動的に:
- 関数のシグネチャを認識
- 依存関係を分析
- 適切なテストケースを生成

---

### Tip 2: マルチファイル編集

複数ファイルを同時に編集する場合、codexが自動的に調整。

**例**:
```
@codex 
このコンポーネントをファイル分割してください。
- メインコンポーネント
- スタイル
- 型定義
- テスト
```

codexが4つのファイルを同時に生成・編集。

---

### Tip 3: プロジェクト固有の設定

プロジェクトごとに`.codex/project.toml`を作成。

```toml
# .codex/project.toml
[project]
name = "my-react-app"
language = "typescript"
framework = "react"

[preferences]
test_framework = "jest"
ui_library = "material-ui"
state_management = "redux"
```

codexがプロジェクト設定を自動認識し、適切なコード生成。

---

### Tip 4: カスタムプロンプト

よく使うプロンプトを`.codex/prompts/`に保存。

```markdown
<!-- .codex/prompts/review.md -->
このコードをレビューして、以下の観点で評価してください:
1. セキュリティ
2. パフォーマンス
3. 可読性
4. テストカバレッジ
```

呼び出し:
```
@codex @review
```

---

## 📈 成功事例

### ケース1: React アプリケーション開発

**タスク**: ダッシュボードアプリの開発

**使用機能**:
- `code-reviewer`: コンポーネント設計レビュー
- `test-gen`: ユニットテスト自動生成
- `docs-expert`: Storybookドキュメント作成

**成果**:
- 開発時間: 50%短縮
- テストカバレッジ: 85% → 95%
- コード品質スコア: A+

---

### ケース2: REST API開発

**タスク**: Node.js + Express APIの実装

**使用機能**:
- `security-expert`: 脆弱性スキャン
- `code-reviewer`: エンドポイント設計レビュー
- `docs-expert`: OpenAPI仕様書生成

**成果**:
- セキュリティ問題: 12件検出・修正
- ドキュメント品質: 大幅改善
- 開発速度: 40%向上

---

### ケース3: レガシーコードのリファクタリング

**タスク**: 5年前のJavaScriptコードをTypeScript化

**使用機能**:
- `code-reviewer`: リファクタリング計画
- `delegate-parallel`: 並列実行で高速化
- `deep-researcher`: TypeScript移行ベストプラクティス調査

**成果**:
- 移行期間: 2週間 → 3日
- 型安全性: 100%
- バグ減少: 70%

---

## 🔗 関連リソース

### ドキュメント

- [セマンティックバージョニング更新](./2025-10-21_セマンティックバージョニング更新.md)
- [実機テスト結果](./2025-10-21_実機テスト結果_v0.48.0-zapabob.1.md)
- [OpenAI/codex 公式](https://github.com/openai/codex)

### 設定ファイル

- `C:\Users\downl\.codex\config.toml` - codex設定
- `C:\Users\downl\.cursor\mcp.json` - Cursor MCP設定
- `.cursorrules` - プロジェクトルール

### サポート

- GitHub Issues: [zapabob/codex](https://github.com/zapabob/codex)
- upstream: [OpenAI/codex](https://github.com/openai/codex)

---

## ✅ チェックリスト

### 初回セットアップ

- [ ] codex-cli v0.48.0-zapabob.1 インストール確認
- [ ] `mcp.json` 設定確認
- [ ] Cursor IDE再起動
- [ ] MCP接続確認（`@codex`呼び出しテスト）
- [ ] config.toml カスタマイズ

### 日常使用

- [ ] コードレビュー時に `@codex` 活用
- [ ] テスト生成を自動化
- [ ] Deep Researchで技術調査効率化
- [ ] 並列実行で高速化
- [ ] Webhook統合でチーム通知

### セキュリティ

- [ ] サンドボックスモード確認
- [ ] API Key環境変数化
- [ ] AI生成コードレビュー
- [ ] `.gitignore` にシークレット追加
- [ ] 定期的な設定監査

---

## 🎉 まとめ

### Cursor統合により実現すること

✅ **生産性3倍向上**
- AI支援によるコーディング速度向上
- 並列エージェント実行
- 自動テスト生成

✅ **コード品質向上**
- 自動コードレビュー
- セキュリティスキャン
- ベストプラクティス適用

✅ **学習効率向上**
- Deep Research機能
- リアルタイムな技術調査
- 引用付きレポート

✅ **チーム連携強化**
- Webhook統合
- 自動通知
- ドキュメント自動生成

---

**作成日時**: 2025-10-21 19:50 JST  
**バージョン**: v0.48.0-zapabob.1  
**ステータス**: ✅ **本番環境対応**

---

*Cursor IDE + codex v0.48.0-zapabob.1 = 次世代AI支援開発環境*

**🚀 Ready for Maximum Productivity!**

