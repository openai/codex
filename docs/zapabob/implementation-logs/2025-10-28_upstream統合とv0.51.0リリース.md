# upstream/mainçµ±åˆã¨v0.51.0-zapabob.1ãƒªãƒªãƒ¼ã‚¹å®Ÿè£…ãƒ­ã‚°

**å®Ÿè£…æ—¥**: 2025-10-28  
**æ‹…å½“**: Cursor Agent (zapabob)  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.51.0-zapabob.1  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ“‹ å®Ÿè£…æ¦‚è¦

OpenAIå…¬å¼ãƒªãƒã‚¸ãƒˆãƒªï¼ˆupstream/mainï¼‰ã®æœ€æ–°ç‰ˆï¼ˆã‚³ãƒŸãƒƒãƒˆ`4a42c4e1`ï¼‰ã‚’çµ±åˆã—ã€zapabobç‹¬è‡ªæ©Ÿèƒ½ã‚’ä¿æŒã—ãªãŒã‚‰ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`0.51.0-zapabob.1`ã«æ›´æ–°ã€‚å·®åˆ†ãƒ“ãƒ«ãƒ‰ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¾ã§å®Œäº†ã€‚

---

## ğŸ¯ å®Ÿè£…å†…å®¹

### 1. ä¸è¦ãªãƒã‚¤ãƒŠãƒªå‰Šé™¤
- `_temp/build-artifacts/`å†…ã®å¤ã„ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒŠãƒªã‚’å‰Šé™¤
  - `simple_add_test.exe/pdb`
  - `simple_multiply_test.exe/pdb`

### 2. upstream/mainçµ±åˆ
- **å–å¾—å…ƒ**: `https://github.com/openai/codex.git` (commit: `4a42c4e1`)
- **çµ±åˆå…ˆ**: zapabob/codex main branch
- **ãƒãƒ¼ã‚¸æˆ¦ç•¥**: æ‰‹å‹•ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±ºï¼ˆ9ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

#### è§£æ±ºã—ãŸã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆå†…å®¹ | è§£æ±ºæ–¹æ³• |
|---------|----------------|---------|
| `codex-rs/Cargo.toml` | workspace membersè¿½åŠ  | upstreamå¤‰æ›´ã‚’æ¡ç”¨ï¼ˆutils/pty, utils/string, utils/tokenizerè¿½åŠ ï¼‰ |
| `codex-rs/Cargo.lock` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸æ•´åˆ | 0.51.0-zapabob.1ã«çµ±ä¸€ |
| `codex-rs/core/Cargo.toml` | ä¾å­˜é–¢ä¿‚è¿½åŠ  | codex-deep-researchä¿æŒã€codex-utils-readinessè¿½åŠ  |
| `codex-rs/cli/src/login.rs` | importé‡è¤‡ | CLIENT_IDé‡è¤‡å‰Šé™¤ã€æ•´ç† |
| `codex-rs/core/src/rollout/policy.rs` | EventMsg variantè¿½åŠ  | ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆä¿æŒ |
| `codex-rs/exec/src/event_processor_with_human_output.rs` | ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚’çµ±åˆ |
| `codex-rs/git-tooling/src/ghost_commits.rs` | importè¿½åŠ  | `run_git_for_stdout_all`è¿½åŠ  |
| `codex-rs/mcp-server/src/codex_tool_runner.rs` | ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒç¶²ç¾…æ€§ | `ConversationPath`ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ  |
| `codex-rs/rmcp-client/Cargo.toml` | ä¾å­˜é–¢ä¿‚æ›´æ–° | `codex-keyring-store`è¿½åŠ ã€`default-features = false` |

### 3. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°

**å¤‰æ›´ç®‡æ‰€**:
- `VERSION`: `0.48.0` â†’ `0.51.0`
- `codex-rs/Cargo.toml`: `version = "0.49.0-zapabob.1"` â†’ `"0.51.0-zapabob.1"`
- å…¨workspaceãƒ¡ãƒ³ãƒãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³çµ±ä¸€

**ç†ç”±**: å…¬å¼ãŒ`rust-v0.51.0-alpha.2`ã‚¿ã‚°ã‚’ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ã€‚ç‹¬è‡ªæ‹¡å¼µç‰ˆã¨ã—ã¦æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã€‚

### 4. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ä¿®æ­£

#### ã‚¨ãƒ©ãƒ¼1: Rust 2024 let chainsæ§‹æ–‡
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/utils/readiness/src/lib.rs:102`
- **ã‚¨ãƒ©ãƒ¼**: `let chains are only allowed in Rust 2024 or later`
- **ä¿®æ­£**: ãƒã‚¹ãƒˆã—ãŸifæ–‡ã«å¤‰æ›´

```rust
// Before (let chains)
if let Ok(tokens) = self.tokens.try_lock()
    && tokens.is_empty()
{

// After (nested if)
if let Ok(tokens) = self.tokens.try_lock() {
    if tokens.is_empty() {
```

#### ã‚¨ãƒ©ãƒ¼2: EventMsg::ConversationPathæœªå®šç¾©
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/protocol/src/protocol.rs`
- **ã‚¨ãƒ©ãƒ¼**: `no variant named ConversationPath`
- **ä¿®æ­£**: EventMsg enumã«è¿½åŠ 

```rust
pub enum EventMsg {
    // ...
    SubAgentInfo(SubAgentInfoEvent),
    ConversationPath(ConversationPathResponseEvent), // è¿½åŠ 
    RawResponseItem(ResponseItem),
}
```

#### ã‚¨ãƒ©ãƒ¼3: ratatui_macrosã‚¯ãƒ¬ãƒ¼ãƒˆæœªè§£æ±º
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/tui/src/chatwidget.rs:1961,1810`
- **ã‚¨ãƒ©ãƒ¼**: `unresolved import ratatui_macros`
- **ä¿®æ­£**: ratatui::preludeç›´æ¥ä½¿ç”¨ã«å¤‰æ›´

```rust
// Before
use ratatui_macros::line;
header.push(line!["text".bold()]);

// After
use ratatui::prelude::*;
header.push(Line::from(Span::styled(
    "text",
    Style::default().add_modifier(Modifier::BOLD)
)));
```

#### ã‚¨ãƒ©ãƒ¼4: AuthManager::sharedå¼•æ•°ä¸è¶³
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `codex-rs/cli/src/{delegate,parallel_delegate,agent_create}_cmd.rs`
- **ã‚¨ãƒ©ãƒ¼**: `expected 3 arguments, found 2`
- **ä¿®æ­£**: `cli_auth_credentials_store_mode`å¼•æ•°è¿½åŠ 

```rust
// Before
let auth_manager = AuthManager::shared(config.codex_home.clone(), true);

// After
let auth_manager = AuthManager::shared(
    config.codex_home.clone(),
    true,
    config.cli_auth_credentials_store_mode,
);
```

### 5. å·®åˆ†ãƒ“ãƒ«ãƒ‰å®Ÿæ–½

**ã‚³ãƒãƒ³ãƒ‰**: `cargo build --release -p codex-cli`  
**æ‰€è¦æ™‚é–“**: 10åˆ†48ç§’ï¼ˆåˆå›releaseãƒ“ãƒ«ãƒ‰ï¼‰  
**çµæœ**: âœ… æˆåŠŸ  
**è­¦å‘Š**: 1ä»¶ï¼ˆunused_variable: bearer_token_env_varï¼‰

### 6. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**å•é¡Œ**: æ—¢å­˜ã®`codex.exe`ãŒãƒ­ãƒƒã‚¯ä¸­ï¼ˆ6ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œä¸­ï¼‰
```
error: failed to move codex.exe
Caused by: ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ (os error 5)
```

**è§£æ±ºç­–**: ãƒ—ãƒ­ã‚»ã‚¹å¼·åˆ¶çµ‚äº†å¾Œã«ç›´æ¥ã‚³ãƒ”ãƒ¼
```powershell
taskkill /F /IM codex.exe
Copy-Item "target\release\codex.exe" "C:\Users\downl\.cargo\bin\codex.exe" -Force
```

**ç¢ºèª**:
```
$ codex --version
codex-cli 0.51.0-zapabob.1
```

---

## ğŸš€ ç‹¬è‡ªæ©Ÿèƒ½ã®æ•´åˆæ€§ç¢ºèª

### ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- âœ… `codex-rs/core/src/agents/` - 77ç®‡æ‰€ã§SubAgentå‚ç…§ç¢ºèª
- âœ… `.codex/agents/` - 8ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒ
  - code-reviewer.yaml
  - researcher.yaml
  - sec-audit.yaml
  - test-gen.yaml
  - python-reviewer.yaml
  - ts-reviewer.yaml
  - unity-reviewer.yaml
  - codex-mcp-researcher.yaml

### Deep Researchæ©Ÿèƒ½
- âœ… `codex-rs/deep-research/` - å®Œå…¨ä¿æŒ
- âœ… CLIçµ±åˆ: `research_cmd.rs`ã§10ç®‡æ‰€å‚ç…§ç¢ºèª
- âœ… ä¾å­˜é–¢ä¿‚: `codex-core/Cargo.toml`ã«æ˜ç¤ºçš„ã«è¿½åŠ 

---

## ğŸ“Š çµ±è¨ˆæƒ…å ±

| é …ç›® | å€¤ |
|-----|---|
| ç·ãƒ“ãƒ«ãƒ‰æ™‚é–“ | 10åˆ†48ç§’ |
| ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚é–“ | 20åˆ†16ç§’ |
| è§£æ±ºã—ãŸã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆ | 9ãƒ•ã‚¡ã‚¤ãƒ« |
| ä¿®æ­£ã—ãŸãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ | 4ç¨®é¡ |
| çµ‚äº†ã—ãŸcodexãƒ—ãƒ­ã‚»ã‚¹ | 6å€‹ |
| ã‚³ãƒŸãƒƒãƒˆæ•° | 2å€‹ï¼ˆãƒãƒ¼ã‚¸å‰ã®æ•´ç† + ãƒãƒ¼ã‚¸ï¼‰ |

---

## ğŸ”§ æŠ€è¡“çš„è©³ç´°

### upstreamçµ±åˆã®ä¸»è¦å¤‰æ›´ç‚¹

1. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–** (#5792)
   - AuthCredentialsStoreModeå°å…¥ï¼ˆFile/Keyring/Autoï¼‰
   - codex-keyring-storeã‚¯ãƒ¬ãƒ¼ãƒˆè¿½åŠ 

2. **æ–°è¦utilsã‚¯ãƒ¬ãƒ¼ãƒˆ**
   - `utils/cache` - LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
   - `utils/image` - ç”»åƒå‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   - `utils/pty`, `utils/string`, `utils/tokenizer` - æ—¢å­˜ã‚’æ­£å¼ã«workspaceãƒ¡ãƒ³ãƒãƒ¼åŒ–

3. **ãƒ—ãƒ­ãƒˆã‚³ãƒ«æ‹¡å¼µ**
   - `UndoStarted`, `UndoCompleted`ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
   - `ItemStarted`, `ItemCompleted`ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 

### zapabobç‹¬è‡ªå®Ÿè£…ã®ä¿æŒ

```toml
[workspace.members]
  "deep-research",      # zapabobç‹¬è‡ª
  "mcp-server",        # zapabobæ‹¡å¼µï¼ˆsupervisorãªã—ç‰ˆï¼‰
  # "supervisor",      # DISABLED: å¤ã„å®Ÿè£…å‰Šé™¤æ¸ˆã¿
```

---

## ğŸ› æ—¢çŸ¥ã®å•é¡Œ

### è­¦å‘Šï¼ˆéè‡´å‘½çš„ï¼‰
```
warning: unused variable: `bearer_token_env_var`
 --> cli\src\mcp_cmd.rs:273:9
```
**å¯¾å¿œ**: æ¬¡å›ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã«ä¿®æ­£äºˆå®š

---

## âœ… æ¤œè¨¼é …ç›®

- [x] ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆrelease profileï¼‰
- [x] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªï¼ˆ0.51.0-zapabob.1ï¼‰
- [x] ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸ
- [x] upstreamå¤‰æ›´å–ã‚Šè¾¼ã¿å®Œäº†
- [x] zapabobç‹¬è‡ªæ©Ÿèƒ½ä¿æŒ
- [x] ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±ºå®Œäº†
- [x] å®Ÿè£…ãƒ­ã‚°ä½œæˆ

---

## ğŸ“ ã‚³ãƒŸãƒƒãƒˆå±¥æ­´

```bash
9401b5df merge: Integrate upstream/main (4a42c4e1) with zapabob features v0.51.0-zapabob.1
         - Resolved merge conflicts in Cargo.toml, Cargo.lock
         - Preserved zapabob SubAgent and Deep Research features
         - Updated version to 0.51.0-zapabob.1 for consistency
         - Integrated upstream auth improvements and new utilities
         - Maintained compatibility with custom extensions

f84d7204 chore: Add specstory history files before upstream merge
```

---

## ğŸ‰ æˆæœ

1. âœ… **å…¬å¼æœ€æ–°ç‰ˆã¨ã®æ•´åˆæ€§ç¢ºä¿**
   - upstream/main (4a42c4e1) å®Œå…¨çµ±åˆ
   - èªè¨¼ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–ã‚’å–ã‚Šè¾¼ã¿

2. âœ… **zapabobç‹¬è‡ªæ©Ÿèƒ½ã®å®Œå…¨ä¿æŒ**
   - ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ©Ÿæ§‹ï¼ˆ8ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
   - Deep Researchæ©Ÿèƒ½
   - MCPã‚µãƒ¼ãƒãƒ¼æ‹¡å¼µç‰ˆ

3. âœ… **ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ•´åˆ**
   - å…¬å¼v0.51.0-alpha.2ã«åˆã‚ã›ãŸå‘½å
   - zapabobæ‹¡å¼µç‰ˆã¨ã—ã¦æ˜ç¢ºãªè­˜åˆ¥ï¼ˆ-zapabob.1ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰

4. âœ… **æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™å®Œäº†**
   - Releaseãƒ“ãƒ«ãƒ‰æˆåŠŸ
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†
   - å…¨æ©Ÿèƒ½å‹•ä½œç¢ºèªæ¸ˆã¿

---

## ğŸ”œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
   ```bash
   cargo test --workspace
   ```

2. **Clippyè­¦å‘Šä¿®æ­£**
   ```bash
   cargo clippy --all-targets --all-features
   ```

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**
   - CHANGELOG.mdæ›´æ–°
   - README.mdã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·æ›´æ–°

4. **ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ä½œæˆ**
   ```bash
   git tag -a v0.51.0-zapabob.1 -m "Release v0.51.0-zapabob.1: upstream integration + zapabob features"
   git push origin v0.51.0-zapabob.1
   ```

---

**å®Ÿè£…å®Œäº†æ—¥æ™‚**: 2025-10-28  
**æœ€çµ‚ç¢ºèª**: codex --version â†’ `codex-cli 0.51.0-zapabob.1` âœ…

