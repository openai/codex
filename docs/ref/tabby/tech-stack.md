# æŠ€æœ¯æ ˆæ€»ç»“

## ä¾èµ–åº“å®Œæ•´æ¸…å•

### æ ¸å¿ƒæœç´¢å¼•æ“

| åº“ | ç‰ˆæœ¬ | ç”¨é€” | å…³é”®ç‰¹æ€§ |
|----|------|------|--------|
| `tantivy` | - | å…¨æ–‡æœç´¢å¼•æ“ | BM25 è¯„åˆ†ã€å­—æ®µæœç´¢ã€å‘é‡å­˜å‚¨ |

### AST å’Œä»£ç åˆ†æ (Tree-sitter)

| åº“ | ç‰ˆæœ¬ | ç”¨é€” | ç‰¹æ€§ |
|----|------|------|------|
| `tree-sitter-tags` | 0.22.6 | AST æ ‡ç­¾æå– | å®šä¹‰/å¼•ç”¨è¯†åˆ«ã€æ–‡æ¡£å­—ç¬¦ä¸²æå– |
| `tree-sitter-python` | 0.21.0 | Python æ”¯æŒ | å‡½æ•°ã€ç±»ã€è£…é¥°å™¨ |
| `tree-sitter-rust` | 0.21.2 | Rust æ”¯æŒ | å‡½æ•°ã€ç»“æ„ä½“ã€traitã€å® |
| `tree-sitter-java` | 0.21.0 | Java æ”¯æŒ | ç±»ã€æ¥å£ã€æ–¹æ³• |
| `tree-sitter-kotlin` | 0.3.6 | Kotlin æ”¯æŒ | ç±»ã€å‡½æ•°ã€æ‰©å±• |
| `tree-sitter-scala` | 0.22.1 | Scala æ”¯æŒ | ç±»ã€traitã€å¯¹è±¡ |
| `tree-sitter-typescript` | 0.21.1 | TypeScript/JavaScript | æ¥å£ã€ç±»å‹ã€ç±»ã€å¼‚æ­¥ |
| `tree-sitter-go` | 0.21.0 | Go æ”¯æŒ | å‡½æ•°ã€ç»“æ„ä½“ã€æ¥å£ |
| `tree-sitter-ruby` | 0.21.0 | Ruby æ”¯æŒ | ç±»ã€æ–¹æ³•ã€å— |
| `tree-sitter-c` | git:00ed08f | C æ”¯æŒ | å‡½æ•°ã€ç»“æ„ä½“ã€å® |
| `tree-sitter-cpp` | git:d29fbff | C++ æ”¯æŒ | ç±»ã€æ¨¡æ¿ã€å‘½åç©ºé—´ |
| `tree-sitter-c-sharp` | 0.21.2 | C# æ”¯æŒ | ç±»ã€å±æ€§ã€å§”æ‰˜ |
| `tree-sitter-solidity` | git:custom | Solidity æ”¯æŒ | åˆçº¦ã€å‡½æ•°ã€äº‹ä»¶ |
| `tree-sitter-lua` | 0.1.0 | Lua æ”¯æŒ | å‡½æ•°ã€è¡¨ |
| `tree-sitter-elixir` | 0.2.0 | Elixir æ”¯æŒ | æ¨¡å—ã€å‡½æ•°ã€å® |
| `tree-sitter-gdscript` | git:custom | GDScript æ”¯æŒ | ç±»ã€å‡½æ•°ã€ä¿¡å· |

### æ–‡æœ¬å¤„ç†

| åº“ | ç‰ˆæœ¬ | ç”¨é€” | ç‰¹æ€§ |
|----|------|------|------|
| `text-splitter` | 0.13.3 (with "code" feature) | ä»£ç æ–‡æœ¬åˆ†å‰² | è¯­è¨€æ„ŸçŸ¥ã€è¯­ä¹‰è¾¹ç•Œä¿æŒ |


### Git å’Œç‰ˆæœ¬æ§åˆ¶

| åº“ | ç‰ˆæœ¬ | ç”¨é€” | ç‰¹æ€§ |
|----|------|------|------|
| `git2` | - | Git æ“ä½œ | cloneã€pullã€æäº¤æŸ¥è¯¢ |

### Tabby é›†æˆ

| åº“ | ç‰ˆæœ¬ | ç”¨é€” | ç‰¹æ€§ |
|----|------|------|------|
| `tabby-common` | - | é€šç”¨ç±»å‹ | é…ç½®ã€é”™è¯¯ç±»å‹ |
| `tabby-inference` | - | åµŒå…¥æ¨ç† | Embedding æ¨¡å‹é›†æˆ |

---

## åˆ†ç±»æ±‡æ€»

### æŒ‰åŠŸèƒ½åˆ†ç±»

```
â”Œâ”€ æœç´¢å’Œç´¢å¼• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ tantivy (å…¨æ–‡æœç´¢)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ä»£ç åˆ†æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ tree-sitter (AST è§£æ)       â”‚
â”‚ â€¢ tree-sitter-tags (æ ‡ç­¾æå–)  â”‚
â”‚ â€¢ 14+ è¯­è¨€åº“                   â”‚
â”‚ â€¢ text-splitter (ä»£ç åˆ†å‰²)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ç³»ç»Ÿé›†æˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ git2 (Git æ“ä½œ)              â”‚
â”‚ â€¢ ignore (æ–‡ä»¶éå†)            â”‚
â”‚ â€¢ tracing/logkit (æ—¥å¿—)        â”‚
â”‚ â€¢ tabby-common/inference       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŒ‰é‡è¦åº¦åˆ†ç±»

#### ğŸ”´ å…³é”®ä¾èµ– (æ— æ³•æ›¿ä»£)

| åº“ | åŸå›  |
|----|------|
| **tantivy** | Rust ç”Ÿæ€æœ€æˆç†Ÿçš„å…¨æ–‡æœç´¢å¼•æ“ |
| **tree-sitter*** | å”¯ä¸€æ”¯æŒ 14+ è¯­è¨€çš„å¢é‡è§£æå™¨ |

#### ğŸŸ¡ é‡è¦ä¾èµ– (å¯æ›¿ä»£ä½†ä»£ä»·å¤§)

| åº“ | æ›¿ä»£æ–¹æ¡ˆ | ä»£ä»· |
|----|---------|------|
| **text-splitter** | è‡ªå®ç° TextSplitter | ä¸­ç­‰ï¼ˆ~100 è¡Œä»£ç ï¼‰ |
| **git2** | gixã€gitoxide | å°ï¼ˆAPI åŸºæœ¬å…¼å®¹ï¼‰ |

---

## ç‰ˆæœ¬ç®¡ç†

### é”å®šç‰ˆæœ¬

```toml
[dependencies]
# æ ¸å¿ƒä¾èµ–: ç²¾ç¡®ç‰ˆæœ¬æˆ–å°ç‰ˆæœ¬å·èŒƒå›´
tantivy = "0.21"                    # å…è®¸ 0.21.x
tree-sitter-tags = "0.22.6"         # ç²¾ç¡®ç‰ˆæœ¬

```

## æ€§èƒ½ç‰¹æ€§

### æ—¶é—´å¤æ‚åº¦

| æ“ä½œ | å¤æ‚åº¦ | è¯´æ˜ |
|------|--------|------|
| **æ–‡ä»¶ç´¢å¼•** | O(n Ã— m) | n=æ–‡ä»¶æ•°, m=å¹³å‡æ–‡ä»¶å¤§å° |
| **AST è§£æ** | O(m) | m=æ–‡ä»¶å¤§å° (tree-sitter å¢é‡) |
| **åµŒå…¥ç”Ÿæˆ** | O(m Ã— k) | m=æ–‡æœ¬é•¿åº¦, k=embedding ç»´åº¦ |
| **BM25 æŸ¥è¯¢** | O(log N + k) | N=ç´¢å¼•å¤§å°, k=ç»“æœæ•° |
| **åƒåœ¾å›æ”¶** | O(N) | N=æ–‡æ¡£æ€»æ•° (éœ€æ‰«æ) |

### ç©ºé—´å¤æ‚åº¦

| èµ„æº | å ç”¨ | ä¼˜åŒ– |
|------|------|------|
| **ç´¢å¼•å¤§å°** | ~150-200% æºä»£ç  | æ®µåˆå¹¶ã€å‹ç¼© |
| **å†…å­˜ä½¿ç”¨** | ~500 MB - 2 GB | å¯é…ç½®ç¼“å†² |
| **ç¼“å­˜** | ~100-500 MB | query/field cache |

### ååé‡

```
åŸºå‡†æµ‹è¯• (å•çº¿ç¨‹):
  â”œâ”€ AST è§£æ: ~10 MB/s (Python)
  â”œâ”€ åµŒå…¥ç”Ÿæˆ: ~1-10 req/s (å–å†³äºæ¨¡å‹)
  â”œâ”€ ç´¢å¼•å†™å…¥: ~1000 docs/s (Tantivy)
  â”œâ”€ å…¨æ–‡æŸ¥è¯¢: ~1000 qps (BM25)
  â””â”€ å‘é‡æŸ¥è¯¢: ~100 qps (ç®€å•å®ç°)

ä¼˜åŒ–å (16 çº¿ç¨‹):
  â”œâ”€ AST è§£æ: ~100 MB/s
  â”œâ”€ åµŒå…¥ç”Ÿæˆ: ~10-100 req/s
  â”œâ”€ ç´¢å¼•å†™å…¥: ~5000 docs/s
  â””â”€ æŸ¥è¯¢: ~5000 qps (BM25) + ~500 qps (vector)
```

---

## å¯¹ codex-rs çš„é›†æˆå»ºè®®

### 1. æœ€å°å¿…éœ€ä¾èµ–

```toml
[dependencies]
# æ ¸å¿ƒç´¢å¼•
tantivy = "0.21"

# ä»£ç åˆ†æ (é€‰æ‹©éœ€è¦çš„è¯­è¨€)
tree-sitter-tags = "0.22"
tree-sitter-rust = "0.21"
tree-sitter-python = "0.21"
tree-sitter-typescript = "0.21"

```

### 3. Rust ç‰¹å®šçš„è¯­è¨€æ”¯æŒ

```rust
// å»ºè®®: ä¼˜å…ˆæ”¯æŒ Rustï¼Œåç»­æ‰©å±•å…¶ä»–è¯­è¨€

æ”¯æŒè®¡åˆ’:
  Phase 1 (MVP):
    â”œâ”€ Rust (tree-sitter-rust)
    â”œâ”€ Python (tree-sitter-python)
    â””â”€ TypeScript (tree-sitter-typescript)

  Phase 2 (æ‰©å±•):
    â”œâ”€ Go, Java, C/C++
    â””â”€ æ›´å¤šé…ç½®é€‰é¡¹

  Phase 3 (ä¼˜åŒ–):
    â”œâ”€ è‡ªå®šä¹‰ CodeSplitter for Rust
    â”œâ”€ Rust-specific AST åˆ†æ
    â””â”€ æ€§èƒ½ä¼˜åŒ–
```

## æ”¯æŒå’Œç»´æŠ¤

### åº“çš„ç»´æŠ¤çŠ¶æ€

| åº“ | ç»´æŠ¤è€… | å‘å¸ƒé¢‘ç‡ | ç¤¾åŒº |
|----|-------|--------|------|
| **tantivy** | æ´»è·ƒ | æ¯ 3 ä¸ªæœˆ | â­ æ´»è·ƒ |
| **tree-sitter*** | å®˜æ–¹ç»´æŠ¤ | å®šæœŸ | â­â­â­ æ´»è·ƒ |
| **git2** | libgit2 ç¤¾åŒº | å®šæœŸ | â­â­ æ´»è·ƒ |

### è·å–å¸®åŠ©

```
èµ„æº:
  â”œâ”€ Tantivy æ–‡æ¡£: https://docs.rs/tantivy
  â”œâ”€ Tree-sitter: https://tree-sitter.github.io
  â”œâ”€ Rust è®ºå›: https://users.rust-lang.org
  â””â”€ GitHub Issues: å„åº“çš„ issue tracker
```

---

## æ€»ä½“å»ºè®®

### âœ“ æ¨èå¤ç”¨çš„éƒ¨åˆ†

1. **Tantivy é›†æˆ**: æˆç†Ÿã€æ€§èƒ½é«˜ã€æ— éœ€é‡å†™
2. **Tree-sitter é…ç½®**: å¤åˆ¶ .scm è§„åˆ™ï¼Œå¯å¤ç”¨
4. **ç´¢å¼•æ¶æ„**: ä¸¤å±‚ç´¢å¼•è®¾è®¡æ˜“äºæ‰©å±•

### âš ï¸ éœ€è¦æ”¹é€ çš„éƒ¨åˆ†

1. **é…ç½®ç³»ç»Ÿ**: Tabby çš„é…ç½®ä¸ codex-rs ä¸åŒ
2. **Embedding é›†æˆ**: éœ€è¦è¿æ¥åˆ° codex-rs çš„æ¨¡å‹æœåŠ¡
3. **é”™è¯¯å¤„ç†**: ä» anyhow æ”¹ä¸º CodexErr
4. **æ—¥å¿—å’Œç›‘æ§**: é›†æˆ codex-rs çš„æ—¥å¿—ç³»ç»Ÿ

### ğŸš€ å¯ä»¥ä¼˜åŒ–çš„éƒ¨åˆ†

1. **Rust ç‰¹å®šåˆ†æ**: è‡ªå®šä¹‰ AST æŸ¥è¯¢è§„åˆ™
2. **æ··åˆæœç´¢**: æƒé‡è°ƒæ•´å’Œé‡æ’
3. **ç¼“å­˜ç­–ç•¥**: é’ˆå¯¹ codex-rs å·¥ä½œè´Ÿè½½ä¼˜åŒ–
4. **æ€§èƒ½è°ƒä¼˜**: åŸºå‡†æµ‹è¯•å’Œç“¶é¢ˆåˆ†æ

---

**ç›¸å…³æ–‡æ¡£**ï¼š
- [å®ç°å‚è€ƒ](./implementation-guide.md) - å…·ä½“é›†æˆæ­¥éª¤
- [æ¶æ„è®¾è®¡](./architecture.md) - æ•´ä½“è®¾è®¡
