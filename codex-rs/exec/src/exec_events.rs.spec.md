## Overview
`exec::exec_events` defines the JSON schema emitted by `codex-exec --json`. The types mirror the structure of automation-focused transcripts, allowing consumers to stream JSONL and reconstruct thread state (turns, commands, file changes, MCP calls, web searches, and errors).

## Detailed Behavior
- `ThreadEvent` (tagged by `"type"`):
  - Lifecycle events (`thread.started`, `turn.started`, `turn.completed`, `turn.failed`).
  - Item events (`item.started`, `item.updated`, `item.completed`) carrying `ThreadItem`.
  - Fatal errors (`error`) for unrecoverable stream failures.
- `Usage` summarizes token consumption per turn; defaults ensure unreported usage serializes as zeros.
- `ThreadItem` holds an ID and `ThreadItemDetails` payload:
  - `AgentMessage`, `Reasoning`, `CommandExecution` (aggregated output, status, exit code), `FileChange` (per-file updates and status), `McpToolCall`, `WebSearch`, `TodoList`, and `Error`.
  - Supporting enums (`CommandExecutionStatus`, `PatchApplyStatus`, `PatchChangeKind`, `McpToolCallStatus`) encode item state transitions.
  - Simple structs (`AgentMessageItem`, `ReasoningItem`, `FileUpdateChange`, `TodoItem`, `TodoListItem`, `ThreadErrorEvent`) provide schema fields, annotated with `ts_rs::TS` for TypeScript generation.

## Broader Context
- `EventProcessorWithJsonOutput` constructs these events; any schema changes must be reflected in both the processor and downstream consumers (e.g., CLI viewers, web dashboards). The TypeScript binding generated by `ts_rs` enables front-end tooling to stay in sync.
- Human-output processors ignore this module, but the schema ensures structured logs remain consistent across versions.
- Context can't yet be determined for future item types (e.g., code review feedback); new variants should be added here and mapped in the JSON processor.

## Technical Debt
- The schema is monolithic; as ThreadItem variants grow, consider splitting into focused modules or reusing protocol definitions to avoid divergence.

---
tech_debt:
  severity: low
  highest_priority_items:
    - Evaluate sharing item definitions with `codex_core::protocol` to avoid duplicating structures when new event types are introduced.
related_specs:
  - ./event_processor_with_jsonl_output.rs.spec.md
  - ../core/src/protocol.rs.spec.md
