load("//:defs.bzl", "codex_rust_crate")

TUI_DEPS = [
    "//codex-rs/ansi-escape",
    "//codex-rs/app-server-protocol",
    "//codex-rs/arg0",
    "//codex-rs/backend-client",
    "//codex-rs/chatgpt",
    "//codex-rs/cloud-requirements",
    "//codex-rs/core",
    "//codex-rs/feedback",
    "//codex-rs/file-search",
    "//codex-rs/login",
    "//codex-rs/otel",
    "//codex-rs/protocol",
    "//codex-rs/state",
    "//codex-rs/utils/absolute-path",
    "//codex-rs/utils/approval-presets",
    "//codex-rs/utils/cli",
    "//codex-rs/utils/elapsed",
    "//codex-rs/utils/fuzzy-match",
    "//codex-rs/utils/oss",
    "//codex-rs/utils/sandbox-summary",
    "//codex-rs/utils/sleep-inhibitor",
    "//codex-rs/windows-sandbox-rs",
    "@crates//:anyhow-1.0.101",
    "@crates//:arboard-3.6.1",
    "@crates//:base64-0.22.1",
    "@crates//:chrono-0.4.43",
    "@crates//:clap-4.5.56",
    "@crates//:color-eyre-0.6.5",
    "@crates//:crossterm-0.28.1",
    "@crates//:derive_more-2.1.1",
    "@crates//:diffy-0.4.2",
    "@crates//:dirs-6.0.0",
    "@crates//:dunce-1.0.5",
    "@crates//:image-0.25.9",
    "@crates//:itertools-0.14.0",
    "@crates//:lazy_static-1.5.0",
    "@crates//:pathdiff-0.2.3",
    "@crates//:pulldown-cmark-0.10.3",
    "@crates//:rand-0.9.2",
    "@crates//:ratatui-0.29.0",
    "@crates//:ratatui-macros-0.6.0",
    "@crates//:regex-lite-0.1.8",
    "@crates//:reqwest-0.12.28",
    "@crates//:rmcp-0.15.0",
    "@crates//:serde-1.0.228",
    "@crates//:serde_json-1.0.149",
    "@crates//:shlex-1.3.0",
    "@crates//:strum-0.27.2",
    "@crates//:supports-color-3.0.2",
    "@crates//:tempfile-3.24.0",
    "@crates//:textwrap-0.16.2",
    "@crates//:thiserror-2.0.18",
    "@crates//:tokio-1.49.0",
    "@crates//:tokio-stream-0.1.18",
    "@crates//:tokio-util-0.7.18",
    "@crates//:toml-0.9.11+spec-1.1.0",
    "@crates//:tracing-0.1.44",
    "@crates//:tracing-appender-0.2.4",
    "@crates//:tracing-subscriber-0.3.22",
    "@crates//:tree-sitter-bash-0.25.1",
    "@crates//:tree-sitter-highlight-0.25.10",
    "@crates//:unicode-segmentation-1.12.0",
    "@crates//:unicode-width-0.2.1",
    "@crates//:url-2.5.8",
    "@crates//:uuid-1.20.0",
    "@crates//:webbrowser-1.0.6",
] + select({
    "@rules_rs//rs/experimental/platforms/config:aarch64-unknown-linux-gnu": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:aarch64-unknown-linux-musl": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:aarch64-apple-darwin": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:aarch64-pc-windows-gnullvm": [
        "@crates//:cpal-0.15.3",
        "@crates//:hound-3.5.1",
        "@crates//:which-8.0.0",
        "@crates//:windows-sys-0.52.0",
        "@crates//:winsplit-0.1.0",
    ],
    "@rules_rs//rs/experimental/platforms/config:x86_64-unknown-linux-gnu": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:x86_64-unknown-linux-musl": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:x86_64-apple-darwin": ["@crates//:libc-0.2.180"],
    "@rules_rs//rs/experimental/platforms/config:x86_64-pc-windows-gnullvm": [
        "@crates//:cpal-0.15.3",
        "@crates//:hound-3.5.1",
        "@crates//:which-8.0.0",
        "@crates//:windows-sys-0.52.0",
        "@crates//:winsplit-0.1.0",
    ],
    "//conditions:default": [],
})

codex_rust_crate(
    name = "tui",
    crate_name = "codex_tui",
    deps_override = TUI_DEPS,
    compile_data = glob(
        include = ["**"],
        exclude = [
            "**/* *",
            "BUILD.bazel",
            "Cargo.toml",
        ],
        allow_empty = True,
    ),
    test_data_extra = glob(["src/**/snapshots/**"]),
    integration_compile_data_extra = ["src/test_backend.rs"],
    extra_binaries = [
        "//codex-rs/cli:codex",
    ],
)
