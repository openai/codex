{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SdkMessage",
  "description": "Messages that can be sent from SDK to CLI via stdin.",
  "oneOf": [
    {
      "description": "SDK hello for version negotiation.",
      "type": "object",
      "required": [
        "type",
        "version"
      ],
      "properties": {
        "capabilities": {
          "description": "Capabilities this SDK supports.",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "type": {
          "type": "string",
          "enum": [
            "sdk_hello"
          ]
        },
        "version": {
          "description": "Protocol version (e.g., \"1.0\").",
          "type": "string"
        }
      }
    },
    {
      "description": "User message/prompt.",
      "type": "object",
      "required": [
        "message",
        "type"
      ],
      "properties": {
        "message": {
          "description": "The message content.",
          "allOf": [
            {
              "$ref": "#/definitions/MessageContent"
            }
          ]
        },
        "session_id": {
          "description": "Session ID for this message.",
          "type": [
            "string",
            "null"
          ]
        },
        "type": {
          "type": "string",
          "enum": [
            "user"
          ]
        }
      }
    },
    {
      "description": "Control request.",
      "type": "object",
      "required": [
        "request",
        "request_id",
        "type"
      ],
      "properties": {
        "request": {
          "description": "The actual request payload.",
          "allOf": [
            {
              "$ref": "#/definitions/ControlRequest"
            }
          ]
        },
        "request_id": {
          "description": "Unique request identifier for correlation.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "control_request"
          ]
        }
      }
    },
    {
      "description": "Control response (answering CLI's request).",
      "type": "object",
      "required": [
        "request_id",
        "response",
        "type"
      ],
      "properties": {
        "request_id": {
          "description": "Request ID this response correlates to.",
          "type": "string"
        },
        "response": {
          "description": "The actual response payload.",
          "allOf": [
            {
              "$ref": "#/definitions/ControlResponse"
            }
          ]
        },
        "type": {
          "type": "string",
          "enum": [
            "control_response"
          ]
        }
      }
    },
    {
      "description": "Cancel a pending control request.",
      "type": "object",
      "required": [
        "request_id",
        "type"
      ],
      "properties": {
        "request_id": {
          "description": "The request ID to cancel.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "control_cancel_request"
          ]
        }
      }
    }
  ],
  "definitions": {
    "ContentBlock": {
      "description": "A content block in a message.",
      "oneOf": [
        {
          "description": "Text content.",
          "type": "object",
          "required": [
            "text",
            "type"
          ],
          "properties": {
            "text": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "text"
              ]
            }
          }
        },
        {
          "description": "Image content.",
          "type": "object",
          "required": [
            "source",
            "type"
          ],
          "properties": {
            "detail": {
              "default": null,
              "anyOf": [
                {
                  "$ref": "#/definitions/ImageDetail"
                },
                {
                  "type": "null"
                }
              ]
            },
            "source": {
              "$ref": "#/definitions/ImageSource"
            },
            "type": {
              "type": "string",
              "enum": [
                "image"
              ]
            }
          }
        },
        {
          "description": "File content.",
          "type": "object",
          "required": [
            "path",
            "type"
          ],
          "properties": {
            "path": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "file"
              ]
            }
          }
        },
        {
          "description": "Tool use request.",
          "type": "object",
          "required": [
            "id",
            "input",
            "name",
            "type"
          ],
          "properties": {
            "id": {
              "type": "string"
            },
            "input": true,
            "name": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "tool_use"
              ]
            }
          }
        },
        {
          "description": "Tool result.",
          "type": "object",
          "required": [
            "content",
            "tool_use_id",
            "type"
          ],
          "properties": {
            "content": true,
            "is_error": {
              "type": [
                "boolean",
                "null"
              ]
            },
            "tool_use_id": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "tool_result"
              ]
            }
          }
        }
      ]
    },
    "ControlRequest": {
      "description": "Unified control request (both directions).",
      "anyOf": [
        {
          "$ref": "#/definitions/OutboundControlRequest"
        },
        {
          "$ref": "#/definitions/InboundControlRequest"
        }
      ]
    },
    "ControlResponse": {
      "description": "Unified control response (both directions).",
      "anyOf": [
        {
          "$ref": "#/definitions/OutboundControlResponse"
        },
        {
          "$ref": "#/definitions/InboundControlResponse"
        }
      ]
    },
    "HookEvent": {
      "description": "Hook event types.",
      "oneOf": [
        {
          "description": "Before a tool is used.",
          "type": "string",
          "enum": [
            "PreToolUse"
          ]
        },
        {
          "description": "After a tool is used.",
          "type": "string",
          "enum": [
            "PostToolUse"
          ]
        },
        {
          "description": "When user submits a prompt.",
          "type": "string",
          "enum": [
            "UserPromptSubmit"
          ]
        },
        {
          "description": "When the agent is about to stop.",
          "type": "string",
          "enum": [
            "Stop"
          ]
        },
        {
          "description": "When a subagent is about to stop.",
          "type": "string",
          "enum": [
            "SubagentStop"
          ]
        },
        {
          "description": "Before compacting conversation history.",
          "type": "string",
          "enum": [
            "PreCompact"
          ]
        }
      ]
    },
    "HookInput": {
      "description": "Input data for hook callbacks.",
      "type": "object",
      "anyOf": [
        {
          "description": "PreToolUse input.",
          "allOf": [
            {
              "$ref": "#/definitions/PreToolUseInput"
            }
          ]
        },
        {
          "description": "PostToolUse input.",
          "allOf": [
            {
              "$ref": "#/definitions/PostToolUseInput"
            }
          ]
        },
        {
          "description": "UserPromptSubmit input.",
          "allOf": [
            {
              "$ref": "#/definitions/UserPromptSubmitInput"
            }
          ]
        },
        {
          "description": "Stop input.",
          "allOf": [
            {
              "$ref": "#/definitions/StopInput"
            }
          ]
        },
        {
          "description": "SubagentStop input.",
          "allOf": [
            {
              "$ref": "#/definitions/SubagentStopInput"
            }
          ]
        },
        {
          "description": "PreCompact input.",
          "allOf": [
            {
              "$ref": "#/definitions/PreCompactInput"
            }
          ]
        }
      ],
      "required": [
        "hook_event_name"
      ],
      "properties": {
        "hook_event_name": {
          "description": "The hook event type.",
          "allOf": [
            {
              "$ref": "#/definitions/HookEvent"
            }
          ]
        }
      }
    },
    "HookPermissionDecision": {
      "description": "Hook permission decision.",
      "oneOf": [
        {
          "description": "Block the operation.",
          "type": "string",
          "enum": [
            "block"
          ]
        }
      ]
    },
    "HookSpecificOutput": {
      "description": "Hook-specific output data.",
      "type": "object",
      "required": [
        "hook_event_name"
      ],
      "properties": {
        "hook_event_name": {
          "description": "Hook event name.",
          "allOf": [
            {
              "$ref": "#/definitions/HookEvent"
            }
          ]
        },
        "modified_tool_input": {
          "description": "Modified tool input (for PreToolUse)."
        },
        "modified_tool_output": {
          "description": "Modified tool output (for PostToolUse)."
        },
        "permission_decision": {
          "description": "Permission decision (for PreToolUse).",
          "type": [
            "string",
            "null"
          ]
        },
        "permission_decision_reason": {
          "description": "Reason for the permission decision.",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "ImageDetail": {
      "description": "Image detail level.",
      "type": "string",
      "enum": [
        "auto",
        "low",
        "high"
      ]
    },
    "ImageSource": {
      "description": "Image source for image content blocks.",
      "oneOf": [
        {
          "description": "Base64 encoded image data.",
          "type": "object",
          "required": [
            "data",
            "media_type",
            "type"
          ],
          "properties": {
            "data": {
              "type": "string"
            },
            "media_type": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "base64"
              ]
            }
          }
        },
        {
          "description": "URL reference.",
          "type": "object",
          "required": [
            "type",
            "url"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "url"
              ]
            },
            "url": {
              "type": "string"
            }
          }
        }
      ]
    },
    "InboundControlRequest": {
      "description": "Control requests sent from CLI to SDK.",
      "oneOf": [
        {
          "description": "Request permission decision for tool usage.",
          "type": "object",
          "required": [
            "agent_id",
            "input",
            "subtype",
            "tool_name",
            "tool_use_id"
          ],
          "properties": {
            "agent_id": {
              "description": "Agent making the request.",
              "type": "string"
            },
            "blocked_path": {
              "description": "Path that triggered the permission check (if applicable).",
              "type": [
                "string",
                "null"
              ]
            },
            "decision_reason": {
              "description": "Formatted reason for the permission check.",
              "type": [
                "string",
                "null"
              ]
            },
            "input": {
              "description": "Tool input parameters."
            },
            "permission_suggestions": {
              "description": "Suggested permission updates.",
              "default": [],
              "type": "array",
              "items": {
                "$ref": "#/definitions/PermissionSuggestion"
              }
            },
            "subtype": {
              "type": "string",
              "enum": [
                "can_use_tool"
              ]
            },
            "tool_name": {
              "description": "Name of the tool being invoked.",
              "type": "string"
            },
            "tool_use_id": {
              "description": "Unique tool use identifier.",
              "type": "string"
            }
          }
        },
        {
          "description": "Execute a hook callback.",
          "type": "object",
          "required": [
            "callback_id",
            "hook_event",
            "input",
            "subtype"
          ],
          "properties": {
            "callback_id": {
              "description": "SDK-assigned callback identifier.",
              "type": "string"
            },
            "hook_event": {
              "description": "Hook event type.",
              "allOf": [
                {
                  "$ref": "#/definitions/HookEvent"
                }
              ]
            },
            "input": {
              "description": "Hook input data.",
              "allOf": [
                {
                  "$ref": "#/definitions/HookInput"
                }
              ]
            },
            "subtype": {
              "type": "string",
              "enum": [
                "hook_callback"
              ]
            },
            "tool_use_id": {
              "description": "Associated tool use ID (if applicable).",
              "type": [
                "string",
                "null"
              ]
            }
          }
        },
        {
          "description": "Route an MCP message.",
          "type": "object",
          "required": [
            "message",
            "server_name",
            "subtype"
          ],
          "properties": {
            "message": {
              "description": "MCP protocol message."
            },
            "server_name": {
              "description": "MCP server name.",
              "type": "string"
            },
            "subtype": {
              "type": "string",
              "enum": [
                "mcp_message"
              ]
            }
          }
        }
      ]
    },
    "InboundControlResponse": {
      "description": "Responses to inbound control requests.",
      "oneOf": [
        {
          "description": "Response to can_use_tool.",
          "type": "object",
          "required": [
            "behavior",
            "subtype"
          ],
          "properties": {
            "behavior": {
              "description": "The permission decision.",
              "allOf": [
                {
                  "$ref": "#/definitions/PermissionBehavior"
                }
              ]
            },
            "message": {
              "description": "Optional message to display.",
              "type": [
                "string",
                "null"
              ]
            },
            "subtype": {
              "type": "string",
              "enum": [
                "can_use_tool_response"
              ]
            },
            "tool_use_id": {
              "description": "Tool use ID this response is for.",
              "type": [
                "string",
                "null"
              ]
            }
          }
        },
        {
          "description": "Response to hook_callback.",
          "type": "object",
          "required": [
            "subtype"
          ],
          "properties": {
            "continue": {
              "description": "Whether to continue execution.",
              "type": [
                "boolean",
                "null"
              ]
            },
            "decision": {
              "description": "Permission decision (for PreToolUse).",
              "anyOf": [
                {
                  "$ref": "#/definitions/HookPermissionDecision"
                },
                {
                  "type": "null"
                }
              ]
            },
            "hook_specific_output": {
              "description": "Hook-specific output.",
              "anyOf": [
                {
                  "$ref": "#/definitions/HookSpecificOutput"
                },
                {
                  "type": "null"
                }
              ]
            },
            "reason": {
              "description": "Reason for the decision.",
              "type": [
                "string",
                "null"
              ]
            },
            "stop_reason": {
              "description": "Reason for stopping (if stopping).",
              "type": [
                "string",
                "null"
              ]
            },
            "subtype": {
              "type": "string",
              "enum": [
                "hook_callback_response"
              ]
            },
            "suppress_output": {
              "description": "Whether to suppress output.",
              "type": [
                "boolean",
                "null"
              ]
            },
            "system_message": {
              "description": "System message to inject.",
              "type": [
                "string",
                "null"
              ]
            }
          }
        },
        {
          "description": "Response to mcp_message.",
          "type": "object",
          "required": [
            "mcp_response",
            "subtype"
          ],
          "properties": {
            "mcp_response": {
              "description": "MCP protocol response."
            },
            "subtype": {
              "type": "string",
              "enum": [
                "mcp_message_response"
              ]
            }
          }
        },
        {
          "description": "Error response.",
          "type": "object",
          "required": [
            "message",
            "subtype"
          ],
          "properties": {
            "message": {
              "type": "string"
            },
            "subtype": {
              "type": "string",
              "enum": [
                "error"
              ]
            }
          }
        }
      ]
    },
    "MessageContent": {
      "description": "Message content structure.",
      "type": "object",
      "required": [
        "content",
        "role"
      ],
      "properties": {
        "content": {
          "description": "Content of the message.",
          "allOf": [
            {
              "$ref": "#/definitions/MessageContentBody"
            }
          ]
        },
        "role": {
          "description": "Role of the message sender.",
          "allOf": [
            {
              "$ref": "#/definitions/MessageRole"
            }
          ]
        }
      }
    },
    "MessageContentBody": {
      "description": "Message content body.",
      "anyOf": [
        {
          "description": "Simple text content.",
          "type": "string"
        },
        {
          "description": "Structured content blocks.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/ContentBlock"
          }
        }
      ]
    },
    "MessageRole": {
      "description": "Role of a message sender.",
      "type": "string",
      "enum": [
        "user",
        "assistant",
        "system"
      ]
    },
    "OutboundControlRequest": {
      "description": "Control requests sent from SDK to CLI.",
      "oneOf": [
        {
          "description": "Interrupt current operation.",
          "type": "object",
          "required": [
            "subtype"
          ],
          "properties": {
            "subtype": {
              "type": "string",
              "enum": [
                "interrupt"
              ]
            }
          }
        },
        {
          "description": "Set permission mode.",
          "type": "object",
          "required": [
            "mode",
            "subtype"
          ],
          "properties": {
            "mode": {
              "$ref": "#/definitions/PermissionMode"
            },
            "subtype": {
              "type": "string",
              "enum": [
                "set_permission_mode"
              ]
            }
          }
        },
        {
          "description": "Set model for subsequent turns.",
          "type": "object",
          "required": [
            "subtype"
          ],
          "properties": {
            "model": {
              "type": [
                "string",
                "null"
              ]
            },
            "subtype": {
              "type": "string",
              "enum": [
                "set_model"
              ]
            }
          }
        },
        {
          "description": "Rewind files to a previous checkpoint.",
          "type": "object",
          "required": [
            "subtype",
            "user_message_id"
          ],
          "properties": {
            "subtype": {
              "type": "string",
              "enum": [
                "rewind_files"
              ]
            },
            "user_message_id": {
              "type": "string"
            }
          }
        },
        {
          "description": "Stream additional input messages.",
          "type": "object",
          "required": [
            "input",
            "subtype"
          ],
          "properties": {
            "input": {
              "type": "array",
              "items": true
            },
            "subtype": {
              "type": "string",
              "enum": [
                "stream_input"
              ]
            }
          }
        }
      ]
    },
    "OutboundControlResponse": {
      "description": "Response to outbound control requests.",
      "oneOf": [
        {
          "description": "Success response.",
          "type": "object",
          "required": [
            "subtype"
          ],
          "properties": {
            "subtype": {
              "type": "string",
              "enum": [
                "success"
              ]
            }
          }
        },
        {
          "description": "Error response.",
          "type": "object",
          "required": [
            "message",
            "subtype"
          ],
          "properties": {
            "message": {
              "type": "string"
            },
            "subtype": {
              "type": "string",
              "enum": [
                "error"
              ]
            }
          }
        }
      ]
    },
    "PermissionBehavior": {
      "description": "Permission behavior decision.",
      "oneOf": [
        {
          "description": "Allow the tool invocation.",
          "type": "string",
          "enum": [
            "allow"
          ]
        },
        {
          "description": "Deny the tool invocation.",
          "type": "string",
          "enum": [
            "deny"
          ]
        },
        {
          "description": "Prompt the user (for interactive mode).",
          "type": "string",
          "enum": [
            "prompt"
          ]
        }
      ]
    },
    "PermissionMode": {
      "description": "Permission mode for tool usage.",
      "oneOf": [
        {
          "description": "Default permission mode - prompt for dangerous operations.",
          "type": "string",
          "enum": [
            "default"
          ]
        },
        {
          "description": "Accept all edits automatically.",
          "type": "string",
          "enum": [
            "acceptEdits"
          ]
        },
        {
          "description": "Plan mode - don't execute, just plan.",
          "type": "string",
          "enum": [
            "plan"
          ]
        },
        {
          "description": "Bypass all permission checks (dangerous).",
          "type": "string",
          "enum": [
            "bypassPermissions"
          ]
        }
      ]
    },
    "PermissionSuggestion": {
      "description": "A suggested permission update.",
      "oneOf": [
        {
          "description": "Allow this invocation once.",
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "allow_once"
              ]
            }
          }
        },
        {
          "description": "Deny this invocation once.",
          "type": "object",
          "required": [
            "type"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "deny_once"
              ]
            }
          }
        },
        {
          "description": "Allow always with a pattern.",
          "type": "object",
          "required": [
            "pattern",
            "type"
          ],
          "properties": {
            "pattern": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "allow_always"
              ]
            }
          }
        },
        {
          "description": "Deny always with a pattern.",
          "type": "object",
          "required": [
            "pattern",
            "type"
          ],
          "properties": {
            "pattern": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "deny_always"
              ]
            }
          }
        }
      ]
    },
    "PostToolUseInput": {
      "description": "PostToolUse hook input.",
      "type": "object",
      "required": [
        "tool_input",
        "tool_name",
        "tool_output"
      ],
      "properties": {
        "agent_id": {
          "description": "Agent ID that made the call.",
          "type": [
            "string",
            "null"
          ]
        },
        "tool_input": {
          "description": "Tool input parameters."
        },
        "tool_name": {
          "description": "Name of the tool that was invoked.",
          "type": "string"
        },
        "tool_output": {
          "description": "Tool output."
        }
      }
    },
    "PreCompactInput": {
      "description": "PreCompact hook input.",
      "type": "object",
      "required": [
        "max_tokens",
        "token_count"
      ],
      "properties": {
        "max_tokens": {
          "description": "Maximum allowed tokens.",
          "type": "integer",
          "format": "int64"
        },
        "token_count": {
          "description": "Current conversation token count.",
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "PreToolUseInput": {
      "description": "PreToolUse hook input.",
      "type": "object",
      "required": [
        "tool_input",
        "tool_name"
      ],
      "properties": {
        "agent_id": {
          "description": "Agent ID making the call.",
          "type": [
            "string",
            "null"
          ]
        },
        "tool_input": {
          "description": "Tool input parameters."
        },
        "tool_name": {
          "description": "Name of the tool being invoked.",
          "type": "string"
        }
      }
    },
    "StopInput": {
      "description": "Stop hook input.",
      "type": "object",
      "properties": {
        "reason": {
          "description": "Reason for stopping.",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "SubagentStopInput": {
      "description": "SubagentStop hook input.",
      "type": "object",
      "required": [
        "agent_id"
      ],
      "properties": {
        "agent_id": {
          "description": "Subagent ID.",
          "type": "string"
        },
        "reason": {
          "description": "Reason for stopping.",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "UserPromptSubmitInput": {
      "description": "UserPromptSubmit hook input.",
      "type": "object",
      "required": [
        "prompt"
      ],
      "properties": {
        "prompt": {
          "description": "The user's prompt text.",
          "type": "string"
        }
      }
    }
  }
}